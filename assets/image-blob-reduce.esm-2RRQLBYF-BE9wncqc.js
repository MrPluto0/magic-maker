import{a6 as $}from"./index-C9HzHbyJ.js";$();var tt=function(A){for(var w,g=1;g<arguments.length;g++){w=Object(arguments[g]);for(var c in w)Object.prototype.hasOwnProperty.call(w,c)&&(A[c]=w[c])}return A};function q(A,w){var g={};return w.forEach(function(c){Object.prototype.hasOwnProperty.call(A,c)&&(g[c]=A[c])}),g}function et(A){return q(A,["alpha","unsharpAmount","unsharpRadius","unsharpThreshold","cancelToken"])}var rt=q,nt=et,Y={assign:tt,pick:rt,pick_pica_resize_options:nt};function N(A){var w={exports:{}};return A(w,w.exports),w.exports}function W(A){throw new Error('Could not dynamically require "'+A+'". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.')}var X=N(function(A,w){(function(g){A.exports=g()})(function(){return function(){function g(c,x,u){function h(e,r){if(!x[e]){if(!c[e]){var a=typeof W=="function"&&W;if(!r&&a)return a(e,!0);if(n)return n(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var o=x[e]={exports:{}};c[e][0].call(o.exports,function(f){var d=c[e][1][f];return h(d||f)},o,o.exports,g,c,x,u)}return x[e].exports}for(var n=typeof W=="function"&&W,t=0;t<u.length;t++)h(u[t]);return h}return g}()({1:[function(g,c,x){var u=g("inherits"),h=g("multimath"),n=g("./mm_unsharp_mask"),t=g("./mm_resize");function e(r){var a=r||[],i={js:a.indexOf("js")>=0,wasm:a.indexOf("wasm")>=0};h.call(this,i),this.features={js:i.js,wasm:i.wasm&&this.has_wasm()},this.use(n),this.use(t)}u(e,h),e.prototype.resizeAndUnsharp=function(r,a){var i=this.resize(r,a);return r.unsharpAmount&&this.unsharp_mask(i,r.toWidth,r.toHeight,r.unsharpAmount,r.unsharpRadius,r.unsharpThreshold),i},c.exports=e},{"./mm_resize":4,"./mm_unsharp_mask":9,inherits:19,multimath:20}],2:[function(g,c,x){function u(t){return t<0?0:t>255?255:t}function h(t,e,r,a,i,o){var f,d,p,I,y,b,Q,M,D,C,j,k=0,B=0;for(D=0;D<a;D++){for(y=0,C=0;C<i;C++){for(b=o[y++],Q=o[y++],M=k+b*4|0,f=d=p=I=0;Q>0;Q--)j=o[y++],I=I+j*t[M+3]|0,p=p+j*t[M+2]|0,d=d+j*t[M+1]|0,f=f+j*t[M]|0,M=M+4|0;e[B+3]=u(I+8192>>14),e[B+2]=u(p+8192>>14),e[B+1]=u(d+8192>>14),e[B]=u(f+8192>>14),B=B+a*4|0}B=(D+1)*4|0,k=(D+1)*r*4|0}}function n(t,e,r,a,i,o){var f,d,p,I,y,b,Q,M,D,C,j,k=0,B=0;for(D=0;D<a;D++){for(y=0,C=0;C<i;C++){for(b=o[y++],Q=o[y++],M=k+b*4|0,f=d=p=I=0;Q>0;Q--)j=o[y++],I=I+j*t[M+3]|0,p=p+j*t[M+2]|0,d=d+j*t[M+1]|0,f=f+j*t[M]|0,M=M+4|0;e[B+3]=u(I+8192>>14),e[B+2]=u(p+8192>>14),e[B+1]=u(d+8192>>14),e[B]=u(f+8192>>14),B=B+a*4|0}B=(D+1)*4|0,k=(D+1)*r*4|0}}c.exports={convolveHorizontally:h,convolveVertically:n}},{}],3:[function(g,c,x){c.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEXA2AAAGAGf39/f39/AGAHf39/f39/fwACDwEDZW52Bm1lbW9yeQIAAAMEAwABAgYGAX8AQQALB1cFEV9fd2FzbV9jYWxsX2N0b3JzAAAIY29udm9sdmUAAQpjb252b2x2ZUhWAAIMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAK7AMDAwABC8YDAQ9/AkAgA0UNACAERQ0AA0AgDCENQQAhE0EAIQcDQCAHQQJqIQYCfyAHQQF0IAVqIgcuAQIiFEUEQEGAwAAhCEGAwAAhCUGAwAAhCkGAwAAhCyAGDAELIBIgBy4BAGohCEEAIQsgFCEHQQAhDiAGIQlBACEPQQAhEANAIAUgCUEBdGouAQAiESAAIAhBAnRqKAIAIgpBGHZsIBBqIRAgCkH/AXEgEWwgC2ohCyAKQRB2Qf8BcSARbCAPaiEPIApBCHZB/wFxIBFsIA5qIQ4gCEEBaiEIIAlBAWohCSAHQQFrIgcNAAsgC0GAQGshCCAOQYBAayEJIA9BgEBrIQogEEGAQGshCyAGIBRqCyEHIAEgDUECdGogCUEOdSIGQf8BIAZB/wFIGyIGQQAgBkEAShtBCHRBgP4DcSAKQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EQdEGAgPwHcSALQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobcjYCACADIA1qIQ0gE0EBaiITIARHDQALIAxBAWoiDCACbCESIAMgDEcNAAsLCx4AQQAgAiADIAQgBSAAEAEgAkEAIAQgBSAGIAEQAQs="},{}],4:[function(g,c,x){c.exports={name:"resize",fn:g("./resize"),wasm_fn:g("./resize_wasm"),wasm_src:g("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(g,c,x){var u=g("./resize_filter_gen"),h=g("./convolve").convolveHorizontally,n=g("./convolve").convolveVertically;function t(e,r,a){for(var i=3,o=r*a*4|0;i<o;)e[i]=255,i=i+4|0}c.exports=function(e){var r=e.src,a=e.width,i=e.height,o=e.toWidth,f=e.toHeight,d=e.scaleX||e.toWidth/e.width,p=e.scaleY||e.toHeight/e.height,I=e.offsetX||0,y=e.offsetY||0,b=e.dest||new Uint8Array(o*f*4),Q=typeof e.quality>"u"?3:e.quality,M=e.alpha||!1,D=u(Q,a,o,d,I),C=u(Q,i,f,p,y),j=new Uint8Array(o*i*4);return h(r,j,a,i,o,D),n(j,b,i,o,f,C),M||t(b,o,f),b}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(g,c,x){var u=g("./resize_filter_info"),h=14;function n(t){return Math.round(t*((1<<h)-1))}c.exports=function(t,e,r,a,i){var o=u[t].filter,f=1/a,d=Math.min(1,a),p=u[t].win/d,I,y,b,Q,M,D,C,j,k,B,F,H,P,R,s,m,l,v=Math.floor((p+1)*2),_=new Int16Array((v+2)*r),U=0,E=!_.subarray||!_.set;for(I=0;I<r;I++){for(y=(I+.5)*f+i,b=Math.max(0,Math.floor(y-p)),Q=Math.min(e-1,Math.ceil(y+p)),M=Q-b+1,D=new Float32Array(M),C=new Int16Array(M),j=0,k=b,B=0;k<=Q;k++,B++)F=o((k+.5-y)*d),j+=F,D[B]=F;for(H=0,B=0;B<D.length;B++)P=D[B]/j,H+=P,C[B]=n(P);for(C[r>>1]+=n(1-H),R=0;R<C.length&&C[R]===0;)R++;if(R<C.length){for(s=C.length-1;s>0&&C[s]===0;)s--;if(m=b+R,l=s-R+1,_[U++]=m,_[U++]=l,!E)_.set(C.subarray(R,s+1),U),U+=l;else for(B=R;B<=s;B++)_[U++]=C[B]}else _[U++]=0,_[U++]=0}return _}},{"./resize_filter_info":7}],7:[function(g,c,x){c.exports=[{win:.5,filter:function(u){return u>=-.5&&u<.5?1:0}},{win:1,filter:function(u){if(u<=-1||u>=1)return 0;if(u>-11920929e-14&&u<11920929e-14)return 1;var h=u*Math.PI;return Math.sin(h)/h*(.54+.46*Math.cos(h/1))}},{win:2,filter:function(u){if(u<=-2||u>=2)return 0;if(u>-11920929e-14&&u<11920929e-14)return 1;var h=u*Math.PI;return Math.sin(h)/h*Math.sin(h/2)/(h/2)}},{win:3,filter:function(u){if(u<=-3||u>=3)return 0;if(u>-11920929e-14&&u<11920929e-14)return 1;var h=u*Math.PI;return Math.sin(h)/h*Math.sin(h/3)/(h/3)}}]},{}],8:[function(g,c,x){var u=g("./resize_filter_gen");function h(r,a,i){for(var o=3,f=a*i*4|0;o<f;)r[o]=255,o=o+4|0}function n(r){return new Uint8Array(r.buffer,0,r.byteLength)}var t=!0;try{t=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1}catch{}function e(r,a,i){if(t){a.set(n(r),i);return}for(var o=i,f=0;f<r.length;f++){var d=r[f];a[o++]=d&255,a[o++]=d>>8&255}}c.exports=function(r){var a=r.src,i=r.width,o=r.height,f=r.toWidth,d=r.toHeight,p=r.scaleX||r.toWidth/r.width,I=r.scaleY||r.toHeight/r.height,y=r.offsetX||0,b=r.offsetY||0,Q=r.dest||new Uint8Array(f*d*4),M=typeof r.quality>"u"?3:r.quality,D=r.alpha||!1,C=u(M,i,f,p,y),j=u(M,o,d,I,b),k=0,B=this.__align(k+Math.max(a.byteLength,Q.byteLength)),F=this.__align(B+o*f*4),H=this.__align(F+C.byteLength),P=H+j.byteLength,R=this.__instance("resize",P),s=new Uint8Array(this.__memory.buffer),m=new Uint32Array(this.__memory.buffer),l=new Uint32Array(a.buffer);m.set(l),e(C,s,F),e(j,s,H);var v=R.exports.convolveHV||R.exports._convolveHV;v(F,H,B,i,o,f,d);var _=new Uint32Array(Q.buffer);return _.set(new Uint32Array(this.__memory.buffer,0,d*f)),D||h(Q,f,d),Q}},{"./resize_filter_gen":6}],9:[function(g,c,x){c.exports={name:"unsharp_mask",fn:g("./unsharp_mask"),wasm_fn:g("./unsharp_mask_wasm"),wasm_src:g("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(g,c,x){var u=g("glur/mono16");function h(n,t,e){for(var r=t*e,a=new Uint16Array(r),i,o,f,d,p=0;p<r;p++)i=n[4*p],o=n[4*p+1],f=n[4*p+2],d=i>=o&&i>=f?i:o>=f&&o>=i?o:f,a[p]=d<<8;return a}c.exports=function(n,t,e,r,a,i){var o,f,d,p,I;if(!(r===0||a<.5)){a>2&&(a=2);var y=h(n,t,e),b=new Uint16Array(y);u(b,t,e,a);for(var Q=r/100*4096+.5|0,M=i<<8,D=t*e,C=0;C<D;C++)o=y[C],p=o-b[C],Math.abs(p)>=M&&(f=o+(Q*p+2048>>12),f=f>65280?65280:f,f=f<0?0:f,o=o!==0?o:1,d=(f<<12)/o|0,I=C*4,n[I]=n[I]*d+2048>>12,n[I+1]=n[I+1]*d+2048>>12,n[I+2]=n[I+2]*d+2048>>12)}}},{"glur/mono16":18}],11:[function(g,c,x){c.exports=function(u,h,n,t,e,r){if(!(t===0||e<.5)){e>2&&(e=2);var a=h*n,i=a*4,o=a*2,f=a*2,d=Math.max(h,n)*4,p=8*4,I=0,y=i,b=y+o,Q=b+f,M=Q+f,D=M+d,C=this.__instance("unsharp_mask",i+o+f*2+d+p,{exp:Math.exp}),j=new Uint32Array(u.buffer),k=new Uint32Array(this.__memory.buffer);k.set(j);var B=C.exports.hsv_v16||C.exports._hsv_v16;B(I,y,h,n),B=C.exports.blurMono16||C.exports._blurMono16,B(y,b,Q,M,D,h,n,e),B=C.exports.unsharp||C.exports._unsharp,B(I,I,y,b,h,n,t,r),j.set(new Uint32Array(this.__memory.buffer,0,a))}}},{}],12:[function(g,c,x){c.exports="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"},{}],13:[function(g,c,x){var u=100;function h(n,t){this.create=n,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=t||2e3}h.prototype.acquire=function(){var n=this,t;return this.available.length!==0?t=this.available.pop():(t=this.create(),t.id=this.lastId++,t.release=function(){return n.release(t)}),this.acquired[t.id]=t,t},h.prototype.release=function(n){var t=this;delete this.acquired[n.id],n.lastUsed=Date.now(),this.available.push(n),this.timeoutId===0&&(this.timeoutId=setTimeout(function(){return t.gc()},u))},h.prototype.gc=function(){var n=this,t=Date.now();this.available=this.available.filter(function(e){return t-e.lastUsed>n.idle?(e.destroy(),!1):!0}),this.available.length!==0?this.timeoutId=setTimeout(function(){return n.gc()},u):this.timeoutId=0},c.exports=h},{}],14:[function(g,c,x){var u=2;c.exports=function(h,n,t,e,r,a){var i=t/h,o=e/n,f=(2*a+u+1)/r;if(f>.5)return[[t,e]];var d=Math.ceil(Math.log(Math.min(i,o))/Math.log(f));if(d<=1)return[[t,e]];for(var p=[],I=0;I<d;I++){var y=Math.round(Math.pow(Math.pow(h,d-I-1)*Math.pow(t,I+1),1/d)),b=Math.round(Math.pow(Math.pow(n,d-I-1)*Math.pow(e,I+1),1/d));p.push([y,b])}return p}},{}],15:[function(g,c,x){var u=1e-5;function h(t){var e=Math.round(t);return Math.abs(t-e)<u?e:Math.floor(t)}function n(t){var e=Math.round(t);return Math.abs(t-e)<u?e:Math.ceil(t)}c.exports=function(t){var e=t.toWidth/t.width,r=t.toHeight/t.height,a=h(t.srcTileSize*e)-2*t.destTileBorder,i=h(t.srcTileSize*r)-2*t.destTileBorder;if(a<1||i<1)throw new Error("Internal error in pica: target tile width/height is too small.");var o,f,d,p,I,y,b=[],Q;for(p=0;p<t.toHeight;p+=i)for(d=0;d<t.toWidth;d+=a)o=d-t.destTileBorder,o<0&&(o=0),I=d+a+t.destTileBorder-o,o+I>=t.toWidth&&(I=t.toWidth-o),f=p-t.destTileBorder,f<0&&(f=0),y=p+i+t.destTileBorder-f,f+y>=t.toHeight&&(y=t.toHeight-f),Q={toX:o,toY:f,toWidth:I,toHeight:y,toInnerX:d,toInnerY:p,toInnerWidth:a,toInnerHeight:i,offsetX:o/e-h(o/e),offsetY:f/r-h(f/r),scaleX:e,scaleY:r,x:h(o/e),y:h(f/r),width:n(I/e),height:n(y/r)},b.push(Q);return b}},{}],16:[function(g,c,x){function u(h){return Object.prototype.toString.call(h)}c.exports.isCanvas=function(h){var n=u(h);return n==="[object HTMLCanvasElement]"||n==="[object OffscreenCanvas]"||n==="[object Canvas]"},c.exports.isImage=function(h){return u(h)==="[object HTMLImageElement]"},c.exports.isImageBitmap=function(h){return u(h)==="[object ImageBitmap]"},c.exports.limiter=function(h){var n=0,t=[];function e(){n<h&&t.length&&(n++,t.shift()())}return function(r){return new Promise(function(a,i){t.push(function(){r().then(function(o){a(o),n--,e()},function(o){i(o),n--,e()})}),e()})}},c.exports.cib_quality_name=function(h){switch(h){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},c.exports.cib_support=function(h){return Promise.resolve().then(function(){if(typeof createImageBitmap>"u")return!1;var n=h(100,100);return createImageBitmap(n,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(t){var e=t.width===10;return t.close(),n=null,e})}).catch(function(){return!1})},c.exports.worker_offscreen_canvas_support=function(){return new Promise(function(h,n){if(typeof OffscreenCanvas>"u"){h(!1);return}function t(a){if(typeof createImageBitmap>"u"){a.postMessage(!1);return}Promise.resolve().then(function(){var i=new OffscreenCanvas(10,10),o=i.getContext("2d");return o.rect(0,0,1,1),createImageBitmap(i,0,0,1,1)}).then(function(){return a.postMessage(!0)},function(){return a.postMessage(!1)})}var e=btoa("(".concat(t.toString(),")(self);")),r=new Worker("data:text/javascript;base64,".concat(e));r.onmessage=function(a){return h(a.data)},r.onerror=n}).then(function(h){return h},function(){return!1})},c.exports.can_use_canvas=function(h){var n=!1;try{var t=h(2,1),e=t.getContext("2d"),r=e.createImageData(2,1);r.data[0]=12,r.data[1]=23,r.data[2]=34,r.data[3]=255,r.data[4]=45,r.data[5]=56,r.data[6]=67,r.data[7]=255,e.putImageData(r,0,0),r=null,r=e.getImageData(0,0,2,1),r.data[0]===12&&r.data[1]===23&&r.data[2]===34&&r.data[3]===255&&r.data[4]===45&&r.data[5]===56&&r.data[6]===67&&r.data[7]===255&&(n=!0)}catch{}return n},c.exports.cib_can_use_region=function(){return new Promise(function(h){if(typeof createImageBitmap>"u"){h(!1);return}var n=new Image;n.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",n.onload=function(){createImageBitmap(n,0,0,n.width,n.height).then(function(t){t.width===n.width&&t.height===n.height?h(!0):h(!1)},function(){return h(!1)})},n.onerror=function(){return h(!1)}})}},{}],17:[function(g,c,x){c.exports=function(){var u=g("./mathlib"),h;onmessage=function(n){var t=n.data.opts,e=!1;if(!t.src&&t.srcBitmap){var r=new OffscreenCanvas(t.width,t.height),a=r.getContext("2d",{alpha:!!t.alpha});a.drawImage(t.srcBitmap,0,0),t.src=a.getImageData(0,0,t.width,t.height).data,r.width=r.height=0,r=null,t.srcBitmap.close(),t.srcBitmap=null,e=!0}h||(h=new u(n.data.features));var i=h.resizeAndUnsharp(t);if(e){var o=new ImageData(new Uint8ClampedArray(i),t.toWidth,t.toHeight),f=new OffscreenCanvas(t.toWidth,t.toHeight),d=f.getContext("2d",{alpha:!!t.alpha});d.putImageData(o,0,0),createImageBitmap(f).then(function(p){postMessage({bitmap:p},[p])})}else postMessage({data:i},[i.buffer])}}},{"./mathlib":1}],18:[function(g,c,x){var u,h,n,t,e,r,a,i;function o(p){p<.5&&(p=.5);var I=Math.exp(.726*.726)/p,y=Math.exp(-I),b=Math.exp(-2*I),Q=(1-y)*(1-y)/(1+2*I*y-b);return u=Q,h=Q*(I-1)*y,n=Q*(I+1)*y,t=-Q*b,e=2*y,r=-b,a=(u+h)/(1-e-r),i=(n+t)/(1-e-r),new Float32Array([u,h,n,t,e,r,a,i])}function f(p,I,y,b,Q,M){var D,C,j,k,B,F,H,P,R,s,m,l,v,_;for(R=0;R<M;R++){for(F=R*Q,H=R,P=0,D=p[F],B=D*b[6],k=B,m=b[0],l=b[1],v=b[4],_=b[5],s=0;s<Q;s++)C=p[F],j=C*m+D*l+k*v+B*_,B=k,k=j,D=C,y[P]=k,P++,F++;for(F--,P--,H+=M*(Q-1),D=p[F],B=D*b[7],k=B,C=D,m=b[2],l=b[3],s=Q-1;s>=0;s--)j=C*m+D*l+k*v+B*_,B=k,k=j,D=C,C=p[F],I[H]=y[P]+k,F--,P--,H-=M}}function d(p,I,y,b){if(b){var Q=new Uint16Array(p.length),M=new Float32Array(Math.max(I,y)),D=o(b);f(p,Q,M,D,I,y),f(Q,p,M,D,y,I)}}c.exports=d},{}],19:[function(g,c,x){typeof Object.create=="function"?c.exports=function(u,h){h&&(u.super_=h,u.prototype=Object.create(h.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}))}:c.exports=function(u,h){if(h){u.super_=h;var n=function(){};n.prototype=h.prototype,u.prototype=new n,u.prototype.constructor=u}}},{}],20:[function(g,c,x){var u=g("object-assign"),h=g("./lib/base64decode"),n=g("./lib/wa_detect"),t={js:!0,wasm:!0};function e(r){if(!(this instanceof e))return new e(r);var a=u({},t,r||{});if(this.options=a,this.__cache={},this.__init_promise=null,this.__modules=a.modules||{},this.__memory=null,this.__wasm={},this.__isLE=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1,!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}e.prototype.has_wasm=n,e.prototype.use=function(r){return this.__modules[r.name]=r,this.options.wasm&&this.has_wasm()&&r.wasm_fn?this[r.name]=r.wasm_fn:this[r.name]=r.fn,this},e.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error(`mathlib: only "wasm" was enabled, but it's not supported`));var r=this;return this.__init_promise=Promise.all(Object.keys(r.__modules).map(function(a){var i=r.__modules[a];return!r.options.wasm||!r.has_wasm()||!i.wasm_fn||r.__wasm[a]?null:WebAssembly.compile(r.__base64decode(i.wasm_src)).then(function(o){r.__wasm[a]=o})})).then(function(){return r}),this.__init_promise},e.prototype.__base64decode=h,e.prototype.__reallocate=function(r){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(r/(64*1024))}),this.__memory;var a=this.__memory.buffer.byteLength;return a<r&&this.__memory.grow(Math.ceil((r-a)/(64*1024))),this.__memory},e.prototype.__instance=function(r,a,i){if(a&&this.__reallocate(a),!this.__wasm[r]){var o=this.__modules[r];this.__wasm[r]=new WebAssembly.Module(this.__base64decode(o.wasm_src))}if(!this.__cache[r]){var f={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[r]=new WebAssembly.Instance(this.__wasm[r],{env:u(f,i||{})})}return this.__cache[r]},e.prototype.__align=function(r,a){a=a||8;var i=r%a;return r+(i?a-i:0)},c.exports=e},{"./lib/base64decode":21,"./lib/wa_detect":22,"object-assign":23}],21:[function(g,c,x){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";c.exports=function(h){for(var n=h.replace(/[\r\n=]/g,""),t=n.length,e=new Uint8Array(t*3>>2),r=0,a=0,i=0;i<t;i++)i%4===0&&i&&(e[a++]=r>>16&255,e[a++]=r>>8&255,e[a++]=r&255),r=r<<6|u.indexOf(n.charAt(i));var o=t%4*6;return o===0?(e[a++]=r>>16&255,e[a++]=r>>8&255,e[a++]=r&255):o===18?(e[a++]=r>>10&255,e[a++]=r>>2&255):o===12&&(e[a++]=r>>4&255),e}},{}],22:[function(g,c,x){var u;c.exports=function(){if(typeof u<"u"||(u=!1,typeof WebAssembly>"u"))return u;try{var h=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),n=new WebAssembly.Module(h),t=new WebAssembly.Instance(n,{});return t.exports.test(4)!==0&&(u=!0),u}catch{}return u}},{}],23:[function(g,c,x){var u=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function t(r){if(r==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}function e(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de",Object.getOwnPropertyNames(r)[0]==="5")return!1;for(var a={},i=0;i<10;i++)a["_"+String.fromCharCode(i)]=i;var o=Object.getOwnPropertyNames(a).map(function(d){return a[d]});if(o.join("")!=="0123456789")return!1;var f={};return"abcdefghijklmnopqrst".split("").forEach(function(d){f[d]=d}),Object.keys(Object.assign({},f)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}c.exports=e()?Object.assign:function(r,a){for(var i,o=t(r),f,d=1;d<arguments.length;d++){i=Object(arguments[d]);for(var p in i)h.call(i,p)&&(o[p]=i[p]);if(u){f=u(i);for(var I=0;I<f.length;I++)n.call(i,f[I])&&(o[f[I]]=i[f[I]])}}return o}},{}],24:[function(g,c,x){var u=arguments[3],h=arguments[4],n=arguments[5],t=JSON.stringify;c.exports=function(e,r){for(var a,i=Object.keys(n),o=0,f=i.length;o<f;o++){var d=i[o],p=n[d].exports;if(p===e||p&&p.default===e){a=d;break}}if(!a){a=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var I={},o=0,f=i.length;o<f;o++){var d=i[o];I[d]=d}h[a]=["function(require,module,exports){"+e+"(self); }",I]}var y=Math.floor(Math.pow(16,8)*Math.random()).toString(16),b={};b[a]=a,h[y]=["function(require,module,exports){var f = require("+t(a)+");(f.default ? f.default : f)(self);}",b];var Q={};M(y);function M(F){Q[F]=!0;for(var H in h[F][1]){var P=h[F][1][H];Q[P]||M(P)}}var D="("+u+")({"+Object.keys(Q).map(function(F){return t(F)+":["+h[F][0]+","+t(h[F][1])+"]"}).join(",")+"},{},["+t(y)+"])",C=window.URL||window.webkitURL||window.mozURL||window.msURL,j=new Blob([D],{type:"text/javascript"});if(r&&r.bare)return j;var k=C.createObjectURL(j),B=new Worker(k);return B.objectURL=k,B}},{}],"/index.js":[function(g,c,x){function u(s,m){return r(s)||e(s,m)||n(s,m)||h()}function h(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n(s,m){if(s){if(typeof s=="string")return t(s,m);var l=Object.prototype.toString.call(s).slice(8,-1);if(l==="Object"&&s.constructor&&(l=s.constructor.name),l==="Map"||l==="Set")return Array.from(s);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return t(s,m)}}function t(s,m){(m==null||m>s.length)&&(m=s.length);for(var l=0,v=new Array(m);l<m;l++)v[l]=s[l];return v}function e(s,m){var l=s==null?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(l!=null){var v=[],_=!0,U=!1,E,G;try{for(l=l.call(s);!(_=(E=l.next()).done)&&(v.push(E.value),!(m&&v.length===m));_=!0);}catch(O){U=!0,G=O}finally{try{!_&&l.return!=null&&l.return()}finally{if(U)throw G}}return v}}function r(s){if(Array.isArray(s))return s}var a=g("object-assign"),i=g("webworkify"),o=g("./lib/mathlib"),f=g("./lib/pool"),d=g("./lib/utils"),p=g("./lib/worker"),I=g("./lib/stepper"),y=g("./lib/tiler"),b={},Q=!1;try{typeof navigator<"u"&&navigator.userAgent&&(Q=navigator.userAgent.indexOf("Safari")>=0)}catch{}var M=1;typeof navigator<"u"&&(M=Math.min(navigator.hardwareConcurrency||1,4));var D={tile:1024,concurrency:M,features:["js","wasm","ww"],idle:2e3,createCanvas:function(s,m){var l=document.createElement("canvas");return l.width=s,l.height=m,l}},C={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},j=!1,k=!1,B=!1,F=!1,H=!1;function P(){return{value:i(p),destroy:function(){if(this.value.terminate(),typeof window<"u"){var s=window.URL||window.webkitURL||window.mozURL||window.msURL;s&&s.revokeObjectURL&&this.value.objectURL&&s.revokeObjectURL(this.value.objectURL)}}}}function R(s){if(!(this instanceof R))return new R(s);this.options=a({},D,s||{});var m="lk_".concat(this.options.concurrency);this.__limit=b[m]||d.limiter(this.options.concurrency),b[m]||(b[m]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}R.prototype.init=function(){var s=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData<"u"&&typeof Uint8ClampedArray<"u")try{new ImageData(new Uint8ClampedArray(400),10,10),j=!0}catch{}typeof ImageBitmap<"u"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?k=!0:this.debug("ImageBitmap does not support .close(), disabled"));var m=this.options.features.slice();if(m.indexOf("all")>=0&&(m=["cib","wasm","js","ww"]),this.__requested_features=m,this.__mathlib=new o(m),m.indexOf("ww")>=0&&typeof window<"u"&&"Worker"in window)try{var l=g("webworkify")(function(){});l.terminate(),this.features.ww=!0;var v="wp_".concat(JSON.stringify(this.options));b[v]?this.__workersPool=b[v]:(this.__workersPool=new f(P,this.options.idle),b[v]=this.__workersPool)}catch{}var _=this.__mathlib.init().then(function(O){a(s.features,O.features)}),U;k?U=d.cib_support(this.options.createCanvas).then(function(O){if(s.features.cib&&m.indexOf("cib")<0){s.debug("createImageBitmap() resize supported, but disabled by config");return}m.indexOf("cib")>=0&&(s.features.cib=O)}):U=Promise.resolve(!1),B=d.can_use_canvas(this.options.createCanvas);var E;k&&j&&m.indexOf("ww")!==-1?E=d.worker_offscreen_canvas_support():E=Promise.resolve(!1),E=E.then(function(O){F=O});var G=d.cib_can_use_region().then(function(O){H=O});return this.__initPromise=Promise.all([_,U,E,G]).then(function(){return s}),this.__initPromise},R.prototype.__invokeResize=function(s,m){var l=this;return m.__mathCache=m.__mathCache||{},Promise.resolve().then(function(){return l.features.ww?new Promise(function(v,_){var U=l.__workersPool.acquire();m.cancelToken&&m.cancelToken.catch(function(G){return _(G)}),U.value.onmessage=function(G){U.release(),G.data.err?_(G.data.err):v(G.data)};var E=[];s.src&&E.push(s.src.buffer),s.srcBitmap&&E.push(s.srcBitmap),U.value.postMessage({opts:s,features:l.__requested_features,preload:{wasm_nodule:l.__mathlib.__}},E)}):{data:l.__mathlib.resizeAndUnsharp(s,m.__mathCache)}})},R.prototype.__extractTileData=function(s,m,l,v,_){if(this.features.ww&&F&&(d.isCanvas(m)||H))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(v.srcImageBitmap||m,s.x,s.y,s.width,s.height).then(function(G){return _.srcBitmap=G,_});if(d.isCanvas(m))return v.srcCtx||(v.srcCtx=m.getContext("2d",{alpha:!!l.alpha})),this.debug("Get tile pixel data"),_.src=v.srcCtx.getImageData(s.x,s.y,s.width,s.height).data,_;this.debug("Draw tile imageBitmap/image to temporary canvas");var U=this.options.createCanvas(s.width,s.height),E=U.getContext("2d",{alpha:!!l.alpha});return E.globalCompositeOperation="copy",E.drawImage(v.srcImageBitmap||m,s.x,s.y,s.width,s.height,0,0,s.width,s.height),this.debug("Get tile pixel data"),_.src=E.getImageData(0,0,s.width,s.height).data,U.width=U.height=0,_},R.prototype.__landTileData=function(s,m,l){var v;if(this.debug("Convert raw rgba tile result to ImageData"),m.bitmap)return l.toCtx.drawImage(m.bitmap,s.toX,s.toY),null;if(j)v=new ImageData(new Uint8ClampedArray(m.data),s.toWidth,s.toHeight);else if(v=l.toCtx.createImageData(s.toWidth,s.toHeight),v.data.set)v.data.set(m.data);else for(var _=v.data.length-1;_>=0;_--)v.data[_]=m.data[_];return this.debug("Draw tile"),Q?l.toCtx.putImageData(v,s.toX,s.toY,s.toInnerX-s.toX,s.toInnerY-s.toY,s.toInnerWidth+1e-5,s.toInnerHeight+1e-5):l.toCtx.putImageData(v,s.toX,s.toY,s.toInnerX-s.toX,s.toInnerY-s.toY,s.toInnerWidth,s.toInnerHeight),null},R.prototype.__tileAndResize=function(s,m,l){var v=this,_={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null},U=function(E){return v.__limit(function(){if(l.canceled)return l.cancelToken;var G={width:E.width,height:E.height,toWidth:E.toWidth,toHeight:E.toHeight,scaleX:E.scaleX,scaleY:E.scaleY,offsetX:E.offsetX,offsetY:E.offsetY,quality:l.quality,alpha:l.alpha,unsharpAmount:l.unsharpAmount,unsharpRadius:l.unsharpRadius,unsharpThreshold:l.unsharpThreshold};return v.debug("Invoke resize math"),Promise.resolve(G).then(function(O){return v.__extractTileData(E,s,l,_,O)}).then(function(O){return v.debug("Invoke resize math"),v.__invokeResize(O,l)}).then(function(O){return l.canceled?l.cancelToken:(_.srcImageData=null,v.__landTileData(E,O,_))})})};return Promise.resolve().then(function(){if(_.toCtx=m.getContext("2d",{alpha:!!l.alpha}),d.isCanvas(s))return null;if(d.isImageBitmap(s))return _.srcImageBitmap=s,_.isImageBitmapReused=!0,null;if(d.isImage(s))return k?(v.debug("Decode image via createImageBitmap"),createImageBitmap(s).then(function(E){_.srcImageBitmap=E}).catch(function(E){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(l.canceled)return l.cancelToken;v.debug("Calculate tiles");var E=y({width:l.width,height:l.height,srcTileSize:v.options.tile,toWidth:l.toWidth,toHeight:l.toHeight,destTileBorder:l.__destTileBorder}),G=E.map(function(z){return U(z)});function O(z){z.srcImageBitmap&&(z.isImageBitmapReused||z.srcImageBitmap.close(),z.srcImageBitmap=null)}return v.debug("Process tiles"),Promise.all(G).then(function(){return v.debug("Finished!"),O(_),m},function(z){throw O(_),z})})},R.prototype.__processStages=function(s,m,l,v){var _=this;if(v.canceled)return v.cancelToken;var U=s.shift(),E=u(U,2),G=E[0],O=E[1],z=s.length===0;v=a({},v,{toWidth:G,toHeight:O,quality:z?v.quality:Math.min(1,v.quality)});var L;return z||(L=this.options.createCanvas(G,O)),this.__tileAndResize(m,z?l:L,v).then(function(){return z?l:(v.width=G,v.height=O,_.__processStages(s,L,l,v))}).then(function(J){return L&&(L.width=L.height=0),J})},R.prototype.__resizeViaCreateImageBitmap=function(s,m,l){var v=this,_=m.getContext("2d",{alpha:!!l.alpha});return this.debug("Resize via createImageBitmap()"),createImageBitmap(s,{resizeWidth:l.toWidth,resizeHeight:l.toHeight,resizeQuality:d.cib_quality_name(l.quality)}).then(function(U){if(l.canceled)return l.cancelToken;if(!l.unsharpAmount)return _.drawImage(U,0,0),U.close(),_=null,v.debug("Finished!"),m;v.debug("Unsharp result");var E=v.options.createCanvas(l.toWidth,l.toHeight),G=E.getContext("2d",{alpha:!!l.alpha});G.drawImage(U,0,0),U.close();var O=G.getImageData(0,0,l.toWidth,l.toHeight);return v.__mathlib.unsharp_mask(O.data,l.toWidth,l.toHeight,l.unsharpAmount,l.unsharpRadius,l.unsharpThreshold),_.putImageData(O,0,0),E.width=E.height=0,O=G=E=_=null,v.debug("Finished!"),m})},R.prototype.resize=function(s,m,l){var v=this;this.debug("Start resize...");var _=a({},C);if(isNaN(l)?l&&(_=a(_,l)):_=a(_,{quality:l}),_.toWidth=m.width,_.toHeight=m.height,_.width=s.naturalWidth||s.width,_.height=s.naturalHeight||s.height,m.width===0||m.height===0)return Promise.reject(new Error("Invalid output size: ".concat(m.width,"x").concat(m.height)));_.unsharpRadius>2&&(_.unsharpRadius=2),_.canceled=!1,_.cancelToken&&(_.cancelToken=_.cancelToken.then(function(E){throw _.canceled=!0,E},function(E){throw _.canceled=!0,E}));var U=3;return _.__destTileBorder=Math.ceil(Math.max(U,2.5*_.unsharpRadius|0)),this.init().then(function(){if(_.canceled)return _.cancelToken;if(v.features.cib)return v.__resizeViaCreateImageBitmap(s,m,_);if(!B){var E=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw E.code="ERR_GET_IMAGE_DATA",E}var G=I(_.width,_.height,_.toWidth,_.toHeight,v.options.tile,_.__destTileBorder);return v.__processStages(G,s,m,_)})},R.prototype.resizeBuffer=function(s){var m=this,l=a({},C,s);return this.init().then(function(){return m.__mathlib.resizeAndUnsharp(l)})},R.prototype.toBlob=function(s,m,l){return m=m||"image/png",new Promise(function(v){if(s.toBlob){s.toBlob(function(O){return v(O)},m,l);return}if(s.convertToBlob){v(s.convertToBlob({type:m,quality:l}));return}for(var _=atob(s.toDataURL(m,l).split(",")[1]),U=_.length,E=new Uint8Array(U),G=0;G<U;G++)E[G]=_.charCodeAt(G);v(new Blob([E],{type:m}))})},R.prototype.debug=function(){},c.exports=R},{"./lib/mathlib":1,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":23,webworkify:24}]},{},[])("/index.js")})}),S=N(function(A){function w(n,t){var e=new Error(n);return e.code=t,e}function g(n){for(var t=n.toString(16).toUpperCase(),e=2-t.length;e>0;e--)t="0"+t;return"0x"+t}function c(n){try{return unescape(encodeURIComponent(n))}catch{return n}}function x(n){try{return decodeURIComponent(escape(n))}catch{return n}}function u(n){return Object.prototype.toString.call(n)==="[object Uint8Array]"}function h(n,t,e){this.input=n.subarray(t,e),this.start=t;var r=String.fromCharCode.apply(null,this.input.subarray(0,4));if(r!=="II*\0"&&r!=="MM\0*")throw w("invalid TIFF signature","EBADDATA");this.big_endian=r[0]==="M"}h.prototype.each=function(n){this.aborted=!1;var t=this.read_uint32(4);for(this.ifds_to_read=[{id:0,offset:t}];this.ifds_to_read.length>0&&!this.aborted;){var e=this.ifds_to_read.shift();e.offset&&this.scan_ifd(e.id,e.offset,n)}},h.prototype.filter=function(n){var t={};t.ifd0={id:0,entries:[]},this.each(function(i){n(i)===!1&&!i.is_subifd_link||i.is_subifd_link&&i.count!==1&&i.format!==4||(t["ifd"+i.ifd]||(t["ifd"+i.ifd]={id:i.ifd,entries:[]}),t["ifd"+i.ifd].entries.push(i))}),delete t.ifd1;var e=8;Object.keys(t).forEach(function(i){e+=2,t[i].entries.forEach(function(o){e+=12+(o.data_length>4?Math.ceil(o.data_length/2)*2:0)}),e+=4}),this.output=new Uint8Array(e),this.output[0]=this.output[1]=(this.big_endian?"M":"I").charCodeAt(0),this.write_uint16(2,42);var r=8,a=this;if(this.write_uint32(4,r),Object.keys(t).forEach(function(i){t[i].written_offset=r;var o=r,f=o+2+t[i].entries.length*12+4;r=f,a.write_uint16(o,t[i].entries.length),t[i].entries.sort(function(p,I){return p.tag-I.tag}).forEach(function(p,I){var y=o+2+I*12;a.write_uint16(y,p.tag),a.write_uint16(y+2,p.format),a.write_uint32(y+4,p.count),p.is_subifd_link?t["ifd"+p.tag]&&(t["ifd"+p.tag].link_offset=y+8):p.data_length<=4?a.output.set(a.input.subarray(p.data_offset-a.start,p.data_offset-a.start+4),y+8):(a.write_uint32(y+8,r),a.output.set(a.input.subarray(p.data_offset-a.start,p.data_offset-a.start+p.data_length),r),r+=Math.ceil(p.data_length/2)*2)});var d=t["ifd"+(t[i].id+1)];d&&(d.link_offset=f-4)}),Object.keys(t).forEach(function(i){t[i].written_offset&&t[i].link_offset&&a.write_uint32(t[i].link_offset,t[i].written_offset)}),this.output.length!==r)throw w("internal error: incorrect buffer size allocated");return this.output},h.prototype.read_uint16=function(n){var t=this.input;if(n+2>t.length)throw w("unexpected EOF","EBADDATA");return this.big_endian?t[n]*256+t[n+1]:t[n]+t[n+1]*256},h.prototype.read_uint32=function(n){var t=this.input;if(n+4>t.length)throw w("unexpected EOF","EBADDATA");return this.big_endian?t[n]*16777216+t[n+1]*65536+t[n+2]*256+t[n+3]:t[n]+t[n+1]*256+t[n+2]*65536+t[n+3]*16777216},h.prototype.write_uint16=function(n,t){var e=this.output;this.big_endian?(e[n]=t>>>8&255,e[n+1]=t&255):(e[n]=t&255,e[n+1]=t>>>8&255)},h.prototype.write_uint32=function(n,t){var e=this.output;this.big_endian?(e[n]=t>>>24&255,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=t&255):(e[n]=t&255,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24&255)},h.prototype.is_subifd_link=function(n,t){return n===0&&t===34665||n===0&&t===34853||n===34665&&t===40965},h.prototype.exif_format_length=function(n){switch(n){case 1:case 2:case 6:case 7:return 1;case 3:case 8:return 2;case 4:case 9:case 11:return 4;case 5:case 10:case 12:return 8;default:return 0}},h.prototype.exif_format_read=function(n,t){var e;switch(n){case 1:case 2:return e=this.input[t],e;case 6:return e=this.input[t],e|(e&128)*33554430;case 3:return e=this.read_uint16(t),e;case 8:return e=this.read_uint16(t),e|(e&32768)*131070;case 4:return e=this.read_uint32(t),e;case 9:return e=this.read_uint32(t),e|0;case 5:case 10:case 11:case 12:return null;case 7:return null;default:return null}},h.prototype.scan_ifd=function(n,t,e){var r=this.read_uint16(t);t+=2;for(var a=0;a<r;a++){var i=this.read_uint16(t),o=this.read_uint16(t+2),f=this.read_uint32(t+4),d=this.exif_format_length(o),p=f*d,I=p<=4?t+8:this.read_uint32(t+8),y=!1;if(I+p>this.input.length)throw w("unexpected EOF","EBADDATA");for(var b=[],Q=I,M=0;M<f;M++,Q+=d){var D=this.exif_format_read(o,Q);if(D===null){b=null;break}b.push(D)}if(Array.isArray(b)&&o===2){try{b=x(String.fromCharCode.apply(null,b))}catch{b=null}b&&b[b.length-1]==="\0"&&(b=b.slice(0,-1))}this.is_subifd_link(n,i)&&Array.isArray(b)&&Number.isInteger(b[0])&&b[0]>0&&(this.ifds_to_read.push({id:i,offset:b[0]}),y=!0);var C={is_big_endian:this.big_endian,ifd:n,tag:i,format:o,count:f,entry_offset:t+this.start,data_length:p,data_offset:I+this.start,value:b,is_subifd_link:y};if(e(C)===!1){this.aborted=!0;return}t+=12}n===0&&this.ifds_to_read.push({id:1,offset:this.read_uint32(t)})},A.exports.is_jpeg=function(n){return n.length>=4&&n[0]===255&&n[1]===216&&n[2]===255},A.exports.jpeg_segments_each=function(n,t){if(!u(n))throw w("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if(typeof t!="function")throw w("Invalid argument (on_segment), Function expected","EINVAL");if(!A.exports.is_jpeg(n))throw w("Unknown file format","ENOTJPEG");for(var e=0,r=n.length,a=!1;;){var i,o;if(e+1>=r)throw w("Unexpected EOF","EBADDATA");var f=n[e],d=n[e+1];if(f===255&&d===255)i=255,o=1;else if(f===255&&d!==0){if(i=d,o=2,!(208<=i&&i<=217||i===1)){if(e+3>=r)throw w("Unexpected EOF","EBADDATA");if(o+=n[e+2]*256+n[e+3],o<2)throw w("Invalid segment length","EBADDATA");if(e+o-1>=r)throw w("Unexpected EOF","EBADDATA")}a&&(i>=208&&i<=215||(a=!1)),i===218&&(a=!0)}else if(a)for(var p=e+1;;p++){if(p>=r)throw w("Unexpected EOF","EBADDATA");if(n[p]===255){if(p+1>=r)throw w("Unexpected EOF","EBADDATA");if(n[p+1]!==0){i=0,o=p-e;break}}}else throw w("Unexpected byte at segment start: "+g(f)+" (offset "+g(e)+")","EBADDATA");if(t({code:i,offset:e,length:o})===!1||i===217)break;e+=o}},A.exports.jpeg_segments_filter=function(n,t){if(!u(n))throw w("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if(typeof t!="function")throw w("Invalid argument (on_segment), Function expected","EINVAL");var e=[],r=0;A.exports.jpeg_segments_each(n,function(o){var f=t(o);if(u(f))e.push({data:f}),r+=f.length;else if(Array.isArray(f))f.filter(u).forEach(function(p){e.push({data:p}),r+=p.length});else if(f!==!1){var d={start:o.offset,end:o.offset+o.length};e.length>0&&e[e.length-1].end===d.start?e[e.length-1].end=d.end:e.push(d),r+=o.length}});var a=new Uint8Array(r),i=0;return e.forEach(function(o){var f=o.data||n.subarray(o.start,o.end);a.set(f,i),i+=f.length}),a},A.exports.jpeg_exif_tags_each=function(n,t){if(!u(n))throw w("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if(typeof t!="function")throw w("Invalid argument (on_exif_entry), Function expected","EINVAL");A.exports.jpeg_segments_each(n,function(e){if(e.code===218)return!1;if(e.code===225&&e.length>=10&&n[e.offset+4]===69&&n[e.offset+5]===120&&n[e.offset+6]===105&&n[e.offset+7]===102&&n[e.offset+8]===0&&n[e.offset+9]===0)return new h(n,e.offset+10,e.offset+e.length).each(t),!1})},A.exports.jpeg_exif_tags_filter=function(n,t){if(!u(n))throw w("Invalid argument (jpeg_bin), Uint8Array expected","EINVAL");if(typeof t!="function")throw w("Invalid argument (on_exif_entry), Function expected","EINVAL");var e=!1;return A.exports.jpeg_segments_filter(n,function(r){if(!e&&(r.code===218&&(e=!0),r.code===225&&r.length>=10&&n[r.offset+4]===69&&n[r.offset+5]===120&&n[r.offset+6]===105&&n[r.offset+7]===102&&n[r.offset+8]===0&&n[r.offset+9]===0)){var a=new h(n,r.offset+10,r.offset+r.length).filter(t);if(!a)return!1;var i=new Uint8Array(10);return i.set(n.slice(r.offset,r.offset+10)),i[2]=a.length+8>>>8&255,i[3]=a.length+8&255,e=!0,[i,a]}})},A.exports.jpeg_add_comment=function(n,t){var e=!1,r=0;return A.exports.jpeg_segments_filter(n,function(a){if(r++,!(r===1&&a.code===216)&&!(r===2&&a.code===224)&&!e){t=c(t);var i=new Uint8Array(5+t.length),o=0;return i[o++]=255,i[o++]=254,i[o++]=t.length+3>>>8&255,i[o++]=t.length+3&255,t.split("").forEach(function(f){i[o++]=f.charCodeAt(0)&255}),i[o++]=0,e=!0,[i,n.subarray(a.offset,a.offset+a.length)]}})}});function K(A){return this._getUint8Array(A.blob).then(function(w){if(A.is_jpeg=S.is_jpeg(w),!A.is_jpeg)return Promise.resolve(A);A.orig_blob=A.blob;try{var g,c;if(S.jpeg_exif_tags_each(w,function(u){if(u.ifd===0&&u.tag===274&&Array.isArray(u.value))return A.orientation=u.value[0]||1,g=u.is_big_endian,c=u.data_offset,!1}),c){var x=g?new Uint8Array([0,1]):new Uint8Array([1,0]);A.blob=new Blob([w.slice(0,c),x,w.slice(c+2)],{type:"image/jpeg"})}}catch{}return A})}function Z(A){if(!A.is_jpeg)return Promise.resolve(A);var w=A.orientation-1;if(!w)return Promise.resolve(A);var g;w&4?g=this.pica.options.createCanvas(A.out_canvas.height,A.out_canvas.width):g=this.pica.options.createCanvas(A.out_canvas.width,A.out_canvas.height);var c=g.getContext("2d");return c.save(),w&1&&c.transform(-1,0,0,1,g.width,0),w&2&&c.transform(-1,0,0,-1,g.width,g.height),w&4&&c.transform(0,1,1,0,0,0),c.drawImage(A.out_canvas,0,0),c.restore(),A.out_canvas.width=A.out_canvas.height=0,A.out_canvas=g,Promise.resolve(A)}function V(A){return A.is_jpeg?Promise.all([this._getUint8Array(A.blob),this._getUint8Array(A.out_blob)]).then(function(w){var g=w[0],c=w[1];if(!S.is_jpeg(g))return Promise.resolve(A);var x=[];return S.jpeg_segments_each(g,function(u){if(u.code===218)return!1;x.push(u)}),x=x.filter(function(u){return u.code===226?!1:u.code>=224&&u.code<240||u.code===254}).map(function(u){return g.slice(u.offset,u.offset+u.length)}),A.out_blob=new Blob([c.slice(0,2)].concat(x).concat([c.slice(20)]),{type:"image/jpeg"}),A}):Promise.resolve(A)}function it(A){A.before("_blob_to_image",K),A.after("_transform",Z),A.after("_create_blob",V)}var at=K,ot=Z,st=V,At=it,ut={jpeg_patch_exif:at,jpeg_rotate_canvas:ot,jpeg_attach_orig_segments:st,assign:At};function T(A){if(!(this instanceof T))return new T(A);A=A||{},this.pica=A.pica||X({}),this.initialized=!1,this.utils=Y}T.prototype.use=function(A){var w=[this].concat(Array.prototype.slice.call(arguments,1));return A.apply(A,w),this};T.prototype.init=function(){this.use(ut.assign)};T.prototype.toBlob=function(A,w){var g=Y.assign({max:1/0},w),c={blob:A,opts:g};return this.initialized||(this.init(),this.initialized=!0),Promise.resolve(c).then(this._blob_to_image).then(this._calculate_size).then(this._transform).then(this._cleanup).then(this._create_blob).then(function(x){return x.out_canvas.width=x.out_canvas.height=0,x.out_blob})};T.prototype.toCanvas=function(A,w){var g=Y.assign({max:1/0},w),c={blob:A,opts:g};return this.initialized||(this.init(),this.initialized=!0),Promise.resolve(c).then(this._blob_to_image).then(this._calculate_size).then(this._transform).then(this._cleanup).then(function(x){return x.out_canvas})};T.prototype.before=function(A,w){if(!this[A])throw new Error('Method "'+A+'" does not exist');if(typeof w!="function")throw new Error('Invalid argument "fn", function expected');var g=this[A],c=this;return this[A]=function(x){return w.call(c,x).then(function(u){return g.call(c,u)})},this};T.prototype.after=function(A,w){if(!this[A])throw new Error('Method "'+A+'" does not exist');if(typeof w!="function")throw new Error('Invalid argument "fn", function expected');var g=this[A],c=this;return this[A]=function(x){return g.call(c,x).then(function(u){return w.call(c,u)})},this};T.prototype._blob_to_image=function(A){var w=window.URL||window.webkitURL||window.mozURL||window.msURL;return A.image=document.createElement("img"),A.image_url=w.createObjectURL(A.blob),A.image.src=A.image_url,new Promise(function(g,c){A.image.onerror=function(){c(new Error("ImageBlobReduce: failed to create Image() from blob"))},A.image.onload=function(){g(A)}})};T.prototype._calculate_size=function(A){var w=A.opts.max/Math.max(A.image.width,A.image.height);return w>1&&(w=1),A.transform_width=Math.max(Math.round(A.image.width*w),1),A.transform_height=Math.max(Math.round(A.image.height*w),1),A.scale_factor=w,Promise.resolve(A)};T.prototype._transform=function(A){A.out_canvas=this.pica.options.createCanvas(A.transform_width,A.transform_height),A.transform_width=null,A.transform_height=null;var w={alpha:A.blob.type==="image/png"};return this.utils.assign(w,this.utils.pick_pica_resize_options(A.opts)),this.pica.resize(A.image,A.out_canvas,w).then(function(){return A})};T.prototype._cleanup=function(A){A.image.src="",A.image=null;var w=window.URL||window.webkitURL||window.mozURL||window.msURL;return w.revokeObjectURL&&w.revokeObjectURL(A.image_url),A.image_url=null,Promise.resolve(A)};T.prototype._create_blob=function(A){return this.pica.toBlob(A.out_canvas,A.blob.type).then(function(w){return A.out_blob=w,A})};T.prototype._getUint8Array=function(A){return A.arrayBuffer?A.arrayBuffer().then(function(w){return new Uint8Array(w)}):new Promise(function(w,g){var c=new FileReader;c.readAsArrayBuffer(A),c.onload=function(){w(new Uint8Array(c.result))},c.onerror=function(){g(new Error("ImageBlobReduce: failed to load data from input blob")),c.abort()},c.onabort=function(){g(new Error("ImageBlobReduce: failed to load data from input blob (aborted)"))}})};T.pica=X;var ht=T,ct=ht;/*! Bundled license information:

image-blob-reduce/dist/image-blob-reduce.esm.mjs:
  (*! image-blob-reduce 3.0.1 https://github.com/nodeca/image-blob-reduce @license MIT *)
  (*!
  
  pica
  https://github.com/nodeca/pica
  
  *)
*/export{ct as default};
