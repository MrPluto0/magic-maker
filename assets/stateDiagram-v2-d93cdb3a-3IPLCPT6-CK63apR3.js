import{v as J,L as P,I as K,E as q,e as Q,V as U,_ as Y,A as tt}from"./chunk-GUXDCX7C-BFclM-67.js";import{S as et}from"./chunk-UFIBX7QP-C9UZe4o2.js";import"./chunk-66ULMTWW-DAJjwhte.js";import"./chunk-LA3PGSPR-BkvMhNdj.js";import"./chunk-LA5IGN2Q-BsUSFtGW.js";import{m as st}from"./chunk-4IXHFASB-BKOEIc2f.js";import{E as at,I as rt,a as ot,b as p,X as S,V as v,w as it,f as lt,q as E}from"./dist-QNDTTFGF-B8YEn6Vc.js";import{c as dt,r as V}from"./index-D_A9KGA0.js";dt();V(at(),1);V(rt(),1);V(ot(),1);var x="rect",D="rectWithTitle",nt="start",ct="end",pt="divider",bt="roundedWithTitle",gt="note",ht="noteGroup",u="statediagram",ut="state",yt=`${u}-${ut}`,X="transition",ft="note",mt="note-edge",$t=`${X} ${mt}`,wt=`${u}-${ft}`,xt="cluster",Tt=`${u}-${xt}`,St="cluster-alt",At=`${u}-${St}`,z="parent",G="note",vt="state",I="----",Dt=`${I}${G}`,_=`${I}${z}`,O="fill:none",W="fill: #333",j="c",F="text",Z="normal",T={},c=0,kt=function(t){let r=Object.keys(t);for(let e of r)t[e]},Et=function(t,r){return r.db.extract(r.db.getRootDocV2()),r.db.getClasses()};function Bt(t){return t==null?"":t.classes?t.classes.join(" "):""}function k(t="",r=0,e="",o=I){let i=e!==null&&e.length>0?`${o}${e}`:"";return`${vt}-${t}${i}-${r}`}var w=(t,r,e,o,i,l)=>{let s=e.id,y=Bt(o[s]);if(s!=="root"){let g=x;e.start===!0&&(g=nt),e.start===!1&&(g=ct),e.type!==q&&(g=e.type),T[s]||(T[s]={id:s,shape:g,description:E.sanitizeText(s,S()),classes:`${y} ${yt}`});let a=T[s];e.description&&(Array.isArray(a.description)?(a.shape=D,a.description.push(e.description)):a.description.length>0?(a.shape=D,a.description===s?a.description=[e.description]:a.description=[a.description,e.description]):(a.shape=x,a.description=e.description),a.description=E.sanitizeTextOrArray(a.description,S())),a.description.length===1&&a.shape===D&&(a.shape=x),!a.type&&e.doc&&(p.info("Setting cluster for ",s,B(e)),a.type="group",a.dir=B(e),a.shape=e.type===Q?pt:bt,a.classes=a.classes+" "+Tt+" "+(l?At:""));let h={labelStyle:"",shape:a.shape,labelText:a.description,classes:a.classes,style:"",id:s,dir:a.dir,domId:k(s,c),type:a.type,padding:15};if(h.centerLabel=!0,e.note){let d={labelStyle:"",shape:gt,labelText:e.note.text,classes:wt,style:"",id:s+Dt+"-"+c,domId:k(s,c,G),type:a.type,padding:15},n={labelStyle:"",shape:ht,labelText:e.note.text,classes:a.classes,style:"",id:s+_,domId:k(s,c,z),type:"group",padding:0};c++;let f=s+_;t.setNode(f,n),t.setNode(d.id,d),t.setNode(s,h),t.setParent(s,f),t.setParent(d.id,f);let b=s,m=d.id;e.note.position==="left of"&&(b=d.id,m=s),t.setEdge(b,m,{arrowhead:"none",arrowType:"",style:O,labelStyle:"",classes:$t,arrowheadStyle:W,labelpos:j,labelType:F,thickness:Z})}else t.setNode(s,h)}r&&r.id!=="root"&&(p.trace("Setting node ",s," to be child of its parent ",r.id),t.setParent(s,r.id)),e.doc&&(p.trace("Adding nodes children "),Vt(t,e,e.doc,o,i,!l))},Vt=(t,r,e,o,i,l)=>{p.trace("items",e),e.forEach(s=>{switch(s.stmt){case Y:w(t,r,s,o,i,l);break;case q:w(t,r,s,o,i,l);break;case U:{w(t,r,s.state1,o,i,l),w(t,r,s.state2,o,i,l);let y={id:"edge"+c,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:O,labelStyle:"",label:E.sanitizeText(s.description,S()),arrowheadStyle:W,labelpos:j,labelType:F,thickness:Z,classes:X};t.setEdge(s.state1.id,s.state2.id,y,c),c++}break}})},B=(t,r=tt)=>{let e=r;if(t.doc)for(let o=0;o<t.doc.length;o++){let i=t.doc[o];i.stmt==="dir"&&(e=i.value)}return e},It=async function(t,r,e,o){p.info("Drawing state diagram (v2)",r),T={},o.db.getDirection();let{securityLevel:i,state:l}=S(),s=l.nodeSpacing||50,y=l.rankSpacing||50;p.info(o.db.getRootDocV2()),o.db.extract(o.db.getRootDocV2()),p.info(o.db.getRootDocV2());let g=o.db.getStates(),a=new st({multigraph:!0,compound:!0}).setGraph({rankdir:B(o.db.getRootDocV2()),nodesep:s,ranksep:y,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});w(a,void 0,o.db.getRootDocV2(),g,o.db,!0);let h;i==="sandbox"&&(h=v("#i"+r));let d=i==="sandbox"?v(h.nodes()[0].contentDocument.body):v("body"),n=d.select(`[id="${r}"]`),f=d.select("#"+r+" g");await et(f,a,["barb"],u,r);let b=8;it.insertTitle(n,"statediagramTitleText",l.titleTopMargin,o.db.getDiagramTitle());let m=n.node().getBBox(),L=m.width+b*2,N=m.height+b*2;n.attr("class",u);let R=n.node().getBBox();lt(n,N,L,l.useMaxWidth);let C=`${R.x-b} ${R.y-b} ${L} ${N}`;p.debug(`viewBox ${C}`),n.attr("viewBox",C);let H=document.querySelectorAll('[id="'+r+'"] .edgeLabel .label');for(let A of H){let M=A.getBBox(),$=document.createElementNS("http://www.w3.org/2000/svg",x);$.setAttribute("rx",0),$.setAttribute("ry",0),$.setAttribute("width",M.width),$.setAttribute("height",M.height),A.insertBefore($,A.firstChild)}},Lt={setConf:kt,getClasses:Et,draw:It},zt={parser:J,db:P,renderer:Lt,styles:K,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,P.clear()}};export{zt as diagram};
