import{d as S,r,a as N,z as j,o as q,A as G,B as H,c as T,w as h,u as f,m as V,p as W,e as C,q as $,g as A,h as u,s as X,f as m,t as Y,E as F,j as J,v as K,x as O,y as P}from"./index-C9HzHbyJ.js";/* empty css                   */import{E as Q}from"./el-input-number-Hl8y28gj.js";import"./el-tooltip-l0sNRNKZ.js";import{h as k}from"./hotkeys.esm-BfWqkGRU.js";const Z={class:"px-8 p-6 flex flex-col items-center w-full"},tt={class:"mt-4 flex w-full justify-between"},et={class:"flex flex-shrink-0 gap-4"},at={class:"flex w-[160px] gap-2 items-center"},st={class:"flex gap-2"},ct=S({__name:"MaskRedraw",props:{dataUrl:{}},emits:["finish"],setup(R,{emit:nt}){const B=R,v=r(),w=r(),x=N({width:0,height:0}),g=j(null),U=r(!1),_=r(!0),D=r(!1),i=r(30),y=r(""),b=(n,e)=>{const t=v.value,d=t.getContext("2d"),s=d.getImageData(0,0,t.width,t.height);for(let a=-i.value;a<i.value;a++)for(let o=-i.value;o<i.value;o++){const c=n+a,l=e+o;if(c>=0&&l>=0&&c<t.width&&l<t.height){const E=(l*t.width+c)*4,p=Math.sqrt(a*a+o*o);p<i.value&&(s.data[E+3]*=p/i.value)}}d.putImageData(s,0,0)},z=()=>{const n=g.undo();w.value.putImageData(n,0,0)},I=()=>{const n=g.redo();w.value.putImageData(n,0,0)},M=()=>{const n=g.reset();w.value.putImageData(n,0,0)},L=()=>{F.info("前端模式下暂不支持局部重绘功能"),_.value=!1};return q(async()=>{if(await G(),!v.value)return;const n=1e3,e=600,t=v.value,d=t.getContext("2d");w.value=d;const s=new Image;s.src=B.dataUrl,s.onload=()=>{let a=s.width,o=s.height;const c=n/s.width,l=e/s.height;if(s.width>n||s.height>e){const p=Math.min(c,l);a=s.width*p,o=s.height*p}x.width=a,x.height=o,t.width=a,t.height=o,d.drawImage(s,0,0,t.width,t.height);const E=d.getImageData(0,0,t.width,t.height);g.push(E)},t.addEventListener("mousedown",a=>{D.value=!0}),t.addEventListener("mousemove",a=>{D.value&&b(a.offsetX,a.offsetY)}),t.addEventListener("mouseup",()=>{D.value=!1;const a=d.getImageData(0,0,t.width,t.height);g.push(a)}),k("ctrl+z",z),k("ctrl+shift+z",I)}),H(()=>{k.unbind("ctrl+z"),k.unbind("ctrl+shift+z")}),(n,e)=>{const t=J,d=K,s=Q,a=O,o=W,c=P;return C(),T(o,{modelValue:f(_),"onUpdate:modelValue":e[2]||(e[2]=l=>V(_)?_.value=l:null),width:"1200","align-center":"",title:"区域重绘"},{default:h(()=>[$((C(),A("div",Z,[u("canvas",{ref_key:"canvasRef",ref:v,style:X({width:`${f(x).width}px`,height:`${f(x).height}px`})},null,4),u("div",tt,[u("div",et,[m(d,null,{default:h(()=>[m(t,{onClick:z},{default:h(()=>e[3]||(e[3]=[u("i",{class:"i-mdi-undo",style:{"font-size":"15px"}},null,-1)])),_:1}),m(t,{onClick:I},{default:h(()=>e[4]||(e[4]=[u("i",{class:"i-mdi-redo",style:{"font-size":"15px"}},null,-1)])),_:1}),m(t,{onClick:M},{default:h(()=>e[5]||(e[5]=[u("i",{class:"i-ep-refresh",style:{"font-size":"17px"}},null,-1)])),_:1})]),_:1}),u("div",at,[e[6]||(e[6]=u("div",{class:"flex-shrink-0"},"笔刷",-1)),m(s,{modelValue:f(i),"onUpdate:modelValue":e[0]||(e[0]=l=>V(i)?i.value=l:null)},null,8,["modelValue"])])]),u("div",st,[m(a,{placeholder:"输入提示词",modelValue:f(y),"onUpdate:modelValue":e[1]||(e[1]=l=>V(y)?y.value=l:null),class:"w-60"},null,8,["modelValue"]),m(t,{type:"primary",onClick:L},{default:h(()=>e[7]||(e[7]=[Y("重绘选区")])),_:1})])])])),[[c,f(U)]])]),_:1},8,["modelValue"])}}});export{ct as _};
