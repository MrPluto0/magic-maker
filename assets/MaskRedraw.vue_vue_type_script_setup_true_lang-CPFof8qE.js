import{d as $,r as h,a as j,x as q,o as G,y as H,z as T,c as W,w as d,u as _,l as y,m as A,e as C,n as X,g as Y,k as p,p as F,f as o,q as J,E as K,_ as O,i as P,j as Q,A as Z,s as tt,t as et,v as at}from"./index-DnwN-RZ1.js";/* empty css                   */import{E as nt}from"./el-input-number-B0Rv-z3B.js";import"./el-tooltip-l0sNRNKZ.js";import{_ as ot}from"./refresh-XanSC-OT.js";import{h as E}from"./hotkeys.esm-BfWqkGRU.js";const st={class:"px-8 p-6 flex flex-col items-center w-full"},lt={class:"mt-4 flex w-full justify-between"},it={class:"flex flex-shrink-0 gap-4"},ct={class:"flex w-[160px] gap-2 items-center"},dt={class:"flex gap-2"},gt=$({__name:"MaskRedraw",props:{dataUrl:{}},emits:["finish"],setup(U,{emit:ut}){const b=U,w=h(),x=h(),k=j({width:0,height:0}),f=q(null),B=h(!1),D=h(!0),I=h(!1),c=h(30),V=h(""),M=(s,n)=>{const t=w.value,l=t.getContext("2d"),e=l.getImageData(0,0,t.width,t.height);for(let a=-c.value;a<c.value;a++)for(let i=-c.value;i<c.value;i++){const u=s+a,r=n+i;if(u>=0&&r>=0&&u<t.width&&r<t.height){const g=(r*t.width+u)*4,m=Math.sqrt(a*a+i*i);m<c.value&&(e.data[g+3]*=m/c.value)}}l.putImageData(e,0,0)},R=()=>{const s=f.undo();x.value.putImageData(s,0,0)},z=()=>{const s=f.redo();x.value.putImageData(s,0,0)},L=()=>{const s=f.reset();x.value.putImageData(s,0,0)},S=()=>{K.info("前端模式下暂不支持局部重绘功能"),D.value=!1};return G(async()=>{if(await H(),!w.value)return;const s=1e3,n=600,t=w.value,l=t.getContext("2d");x.value=l;const e=new Image;e.src=b.dataUrl,e.onload=()=>{let a=e.width,i=e.height;const u=s/e.width,r=n/e.height;if(e.width>s||e.height>n){const m=Math.min(u,r);a=e.width*m,i=e.height*m}k.width=a,k.height=i,t.width=a,t.height=i,l.drawImage(e,0,0,t.width,t.height);const g=l.getImageData(0,0,t.width,t.height);f.push(g)},t.addEventListener("mousedown",a=>{I.value=!0}),t.addEventListener("mousemove",a=>{I.value&&M(a.offsetX,a.offsetY)}),t.addEventListener("mouseup",()=>{I.value=!1;const a=l.getImageData(0,0,t.width,t.height);f.push(a)}),E("ctrl+z",R),E("ctrl+shift+z",z)}),T(()=>{E.unbind("ctrl+z"),E.unbind("ctrl+shift+z")}),(s,n)=>{const t=O,l=P,e=Q,a=Z,i=ot,u=tt,r=nt,g=et,m=A,N=at;return C(),W(m,{modelValue:_(D),"onUpdate:modelValue":n[2]||(n[2]=v=>y(D)?D.value=v:null),width:"1200","align-center":"",title:"区域重绘"},{default:d(()=>[X((C(),Y("div",st,[p("canvas",{ref_key:"canvasRef",ref:w,style:F({width:`${_(k).width}px`,height:`${_(k).height}px`})},null,4),p("div",lt,[p("div",it,[o(u,null,{default:d(()=>[o(e,{onClick:R},{default:d(()=>[o(l,{size:"15"},{default:d(()=>[o(t)]),_:1})]),_:1}),o(e,{onClick:z},{default:d(()=>[o(l,{size:"15"},{default:d(()=>[o(a)]),_:1})]),_:1}),o(e,{onClick:L},{default:d(()=>[o(l,{size:"17"},{default:d(()=>[o(i)]),_:1})]),_:1})]),_:1}),p("div",ct,[n[3]||(n[3]=p("div",{class:"flex-shrink-0"},"笔刷",-1)),o(r,{modelValue:_(c),"onUpdate:modelValue":n[0]||(n[0]=v=>y(c)?c.value=v:null)},null,8,["modelValue"])])]),p("div",dt,[o(g,{placeholder:"输入提示词",modelValue:_(V),"onUpdate:modelValue":n[1]||(n[1]=v=>y(V)?V.value=v:null),class:"w-60"},null,8,["modelValue"]),o(e,{type:"primary",onClick:S},{default:d(()=>n[4]||(n[4]=[J("重绘选区")])),_:1})])])])),[[N,_(B)]])]),_:1},8,["modelValue"])}}});export{gt as _};
