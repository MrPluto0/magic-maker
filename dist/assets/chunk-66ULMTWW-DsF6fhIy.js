import{p as it}from"./chunk-LA3PGSPR-DuQNQ5r_.js";import{d as R,X as u,B as Q,o as G,V as _,b as f,w as D,R as lt,U as dt}from"./dist-QNDTTFGF-xyGUN-Ni.js";import{c as ht}from"./index-KuFrev5g.js";ht();var ot=(a,t,e,n)=>{t.forEach(l=>{mt[l](a,e,n)})},ct=(a,t,e)=>{f.trace("Making markers for ",e),a.append("defs").append("marker").attr("id",e+"_"+t+"-extensionStart").attr("class","marker extension "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),a.append("defs").append("marker").attr("id",e+"_"+t+"-extensionEnd").attr("class","marker extension "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z")},yt=(a,t,e)=>{a.append("defs").append("marker").attr("id",e+"_"+t+"-compositionStart").attr("class","marker composition "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),a.append("defs").append("marker").attr("id",e+"_"+t+"-compositionEnd").attr("class","marker composition "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},pt=(a,t,e)=>{a.append("defs").append("marker").attr("id",e+"_"+t+"-aggregationStart").attr("class","marker aggregation "+t).attr("refX",18).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),a.append("defs").append("marker").attr("id",e+"_"+t+"-aggregationEnd").attr("class","marker aggregation "+t).attr("refX",1).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z")},gt=(a,t,e)=>{a.append("defs").append("marker").attr("id",e+"_"+t+"-dependencyStart").attr("class","marker dependency "+t).attr("refX",6).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),a.append("defs").append("marker").attr("id",e+"_"+t+"-dependencyEnd").attr("class","marker dependency "+t).attr("refX",13).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},xt=(a,t,e)=>{a.append("defs").append("marker").attr("id",e+"_"+t+"-lollipopStart").attr("class","marker lollipop "+t).attr("refX",13).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6),a.append("defs").append("marker").attr("id",e+"_"+t+"-lollipopEnd").attr("class","marker lollipop "+t).attr("refX",1).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("circle").attr("stroke","black").attr("fill","transparent").attr("cx",7).attr("cy",7).attr("r",6)},ft=(a,t,e)=>{a.append("marker").attr("id",e+"_"+t+"-pointEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",6).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),a.append("marker").attr("id",e+"_"+t+"-pointStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",4.5).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto").append("path").attr("d","M 0 5 L 10 10 L 10 0 z").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},wt=(a,t,e)=>{a.append("marker").attr("id",e+"_"+t+"-circleEnd").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",11).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0"),a.append("marker").attr("id",e+"_"+t+"-circleStart").attr("class","marker "+t).attr("viewBox","0 0 10 10").attr("refX",-1).attr("refY",5).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("circle").attr("cx","5").attr("cy","5").attr("r","5").attr("class","arrowMarkerPath").style("stroke-width",1).style("stroke-dasharray","1,0")},ut=(a,t,e)=>{a.append("marker").attr("id",e+"_"+t+"-crossEnd").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",12).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0"),a.append("marker").attr("id",e+"_"+t+"-crossStart").attr("class","marker cross "+t).attr("viewBox","0 0 11 11").attr("refX",-1).attr("refY",5.2).attr("markerUnits","userSpaceOnUse").attr("markerWidth",11).attr("markerHeight",11).attr("orient","auto").append("path").attr("d","M 1,1 l 9,9 M 10,1 l -9,9").attr("class","arrowMarkerPath").style("stroke-width",2).style("stroke-dasharray","1,0")},bt=(a,t,e)=>{a.append("defs").append("marker").attr("id",e+"_"+t+"-barbEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",14).attr("markerUnits","strokeWidth").attr("orient","auto").append("path").attr("d","M 19,7 L9,13 L14,7 L9,1 Z")},mt={extension:ct,composition:yt,aggregation:pt,dependency:gt,lollipop:xt,point:ft,circle:wt,cross:ut,barb:bt},or=ot;function kt(a,t){t&&a.attr("style",t)}function Lt(a){let t=_(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")),e=t.append("xhtml:div"),n=a.label,l=a.isNode?"nodeLabel":"edgeLabel";return e.html('<span class="'+l+'" '+(a.labelStyle?'style="'+a.labelStyle+'"':"")+">"+n+"</span>"),kt(e,a.labelStyle),e.style("display","inline-block"),e.style("white-space","nowrap"),e.attr("xmlns","http://www.w3.org/1999/xhtml"),t.node()}var St=(a,t,e,n)=>{let l=a||"";if(typeof l=="object"&&(l=l[0]),R(u().flowchart.htmlLabels)){l=l.replace(/\\n|\n/g,"<br />"),f.debug("vertexText"+l);let r={isNode:n,label:G(l).replace(/fa[blrs]?:fa-[\w-]+/g,i=>`<i class='${i.replace(":"," ")}'></i>`),labelStyle:t.replace("fill:","color:")};return Lt(r)}else{let r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("style",t.replace("color:","fill:"));let i=[];typeof l=="string"?i=l.split(/\\n|\n|<br\s*\/?>/gi):Array.isArray(l)?i=l:i=[];for(let s of i){let d=document.createElementNS("http://www.w3.org/2000/svg","tspan");d.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),d.setAttribute("dy","1em"),d.setAttribute("x","0"),e?d.setAttribute("class","title-row"):d.setAttribute("class","row"),d.textContent=s.trim(),r.appendChild(d)}return r}},P=St,M=async(a,t,e,n)=>{let l,r=t.useHtmlLabels||R(u().flowchart.htmlLabels);e?l=e:l="node default";let i=a.insert("g").attr("class",l).attr("id",t.domId||t.id),s=i.insert("g").attr("class","label").attr("style",t.labelStyle),d;t.labelText===void 0?d="":d=typeof t.labelText=="string"?t.labelText:t.labelText[0];let o=s.node(),h;t.labelType==="markdown"?h=it(s,Q(G(d),u()),{useHtmlLabels:r,width:t.width||u().flowchart.wrappingWidth,classes:"markdown-node-label"}):h=o.appendChild(P(Q(G(d),u()),t.labelStyle,!1,n));let c=h.getBBox(),p=t.padding/2;if(R(u().flowchart.htmlLabels)){let y=h.children[0],x=_(h),k=y.getElementsByTagName("img");if(k){let g=d.replace(/<img[^>]*>/g,"").trim()==="";await Promise.all([...k].map(w=>new Promise(v=>{function B(){if(w.style.display="flex",w.style.flexDirection="column",g){let C=u().fontSize?u().fontSize:window.getComputedStyle(document.body).fontSize,O=5,N=parseInt(C,10)*O+"px";w.style.minWidth=N,w.style.maxWidth=N}else w.style.width="100%";v(w)}setTimeout(()=>{w.complete&&B()}),w.addEventListener("error",B),w.addEventListener("load",B)})))}c=y.getBoundingClientRect(),x.attr("width",c.width),x.attr("height",c.height)}return r?s.attr("transform","translate("+-c.width/2+", "+-c.height/2+")"):s.attr("transform","translate(0, "+-c.height/2+")"),t.centerLabel&&s.attr("transform","translate("+-c.width/2+", "+-c.height/2+")"),s.insert("rect",":first-child"),{shapeSvg:i,bbox:c,halfPadding:p,label:s}},m=(a,t)=>{let e=t.node().getBBox();a.width=e.width,a.height=e.height};function X(a,t,e,n){return a.insert("polygon",":first-child").attr("points",n.map(function(l){return l.x+","+l.y}).join(" ")).attr("class","label-container").attr("transform","translate("+-t/2+","+e/2+")")}function vt(a,t){return a.intersect(t)}function nt(a,t,e,n){var l=a.x,r=a.y,i=l-n.x,s=r-n.y,d=Math.sqrt(t*t*s*s+e*e*i*i),o=Math.abs(t*e*i/d);n.x<l&&(o=-o);var h=Math.abs(t*e*s/d);return n.y<r&&(h=-h),{x:l+o,y:r+h}}function Mt(a,t,e){return nt(a,t,t,e)}function Tt(a,t,e,n){var l,r,i,s,d,o,h,c,p,y,x,k,g,w,v;if(l=t.y-a.y,i=a.x-t.x,d=t.x*a.y-a.x*t.y,p=l*e.x+i*e.y+d,y=l*n.x+i*n.y+d,!(p!==0&&y!==0&&F(p,y))&&(r=n.y-e.y,s=e.x-n.x,o=n.x*e.y-e.x*n.y,h=r*a.x+s*a.y+o,c=r*t.x+s*t.y+o,!(h!==0&&c!==0&&F(h,c))&&(x=l*s-r*i,x!==0)))return k=Math.abs(x/2),g=i*o-s*d,w=g<0?(g-k)/x:(g+k)/x,g=r*d-l*o,v=g<0?(g-k)/x:(g+k)/x,{x:w,y:v}}function F(a,t){return a*t>0}function Bt(a,t,e){var n=a.x,l=a.y,r=[],i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;typeof t.forEach=="function"?t.forEach(function(x){i=Math.min(i,x.x),s=Math.min(s,x.y)}):(i=Math.min(i,t.x),s=Math.min(s,t.y));for(var d=n-a.width/2-i,o=l-a.height/2-s,h=0;h<t.length;h++){var c=t[h],p=t[h<t.length-1?h+1:0],y=Tt(a,e,{x:d+c.x,y:o+c.y},{x:d+p.x,y:o+p.y});y&&r.push(y)}return r.length?(r.length>1&&r.sort(function(x,k){var g=x.x-e.x,w=x.y-e.y,v=Math.sqrt(g*g+w*w),B=k.x-e.x,C=k.y-e.y,O=Math.sqrt(B*B+C*C);return v<O?-1:v===O?0:1}),r[0]):a}var _t=(a,t)=>{var e=a.x,n=a.y,l=t.x-e,r=t.y-n,i=a.width/2,s=a.height/2,d,o;return Math.abs(r)*i>Math.abs(l)*s?(r<0&&(s=-s),d=r===0?0:s*l/r,o=s):(l<0&&(i=-i),d=i,o=l===0?0:i*r/l),{x:e+d,y:n+o}},Ct=_t,b={node:vt,circle:Mt,ellipse:nt,polygon:Bt,rect:Ct},Et=async(a,t)=>{t.useHtmlLabels||u().flowchart.htmlLabels||(t.centerLabel=!0);let{shapeSvg:e,bbox:n,halfPadding:l}=await M(a,t,"node "+t.classes,!0);f.info("Classes = ",t.classes);let r=e.insert("rect",":first-child");return r.attr("rx",t.rx).attr("ry",t.ry).attr("x",-n.width/2-l).attr("y",-n.height/2-l).attr("width",n.width+t.padding).attr("height",n.height+t.padding),m(t,r),t.intersect=function(i){return b.rect(t,i)},e},$t=Et,Pt=a=>{let t=new Set;for(let e of a)switch(e){case"x":t.add("right"),t.add("left");break;case"y":t.add("up"),t.add("down");break;default:t.add(e);break}return t},Rt=(a,t,e)=>{let n=Pt(a),l=2,r=t.height+2*e.padding,i=r/l,s=t.width+2*i+e.padding,d=e.padding/2;return n.has("right")&&n.has("left")&&n.has("up")&&n.has("down")?[{x:0,y:0},{x:i,y:0},{x:s/2,y:2*d},{x:s-i,y:0},{x:s,y:0},{x:s,y:-r/3},{x:s+2*d,y:-r/2},{x:s,y:-2*r/3},{x:s,y:-r},{x:s-i,y:-r},{x:s/2,y:-r-2*d},{x:i,y:-r},{x:0,y:-r},{x:0,y:-2*r/3},{x:-2*d,y:-r/2},{x:0,y:-r/3}]:n.has("right")&&n.has("left")&&n.has("up")?[{x:i,y:0},{x:s-i,y:0},{x:s,y:-r/2},{x:s-i,y:-r},{x:i,y:-r},{x:0,y:-r/2}]:n.has("right")&&n.has("left")&&n.has("down")?[{x:0,y:0},{x:i,y:-r},{x:s-i,y:-r},{x:s,y:0}]:n.has("right")&&n.has("up")&&n.has("down")?[{x:0,y:0},{x:s,y:-i},{x:s,y:-r+i},{x:0,y:-r}]:n.has("left")&&n.has("up")&&n.has("down")?[{x:s,y:0},{x:0,y:-i},{x:0,y:-r+i},{x:s,y:-r}]:n.has("right")&&n.has("left")?[{x:i,y:0},{x:i,y:-d},{x:s-i,y:-d},{x:s-i,y:0},{x:s,y:-r/2},{x:s-i,y:-r},{x:s-i,y:-r+d},{x:i,y:-r+d},{x:i,y:-r},{x:0,y:-r/2}]:n.has("up")&&n.has("down")?[{x:s/2,y:0},{x:0,y:-d},{x:i,y:-d},{x:i,y:-r+d},{x:0,y:-r+d},{x:s/2,y:-r},{x:s,y:-r+d},{x:s-i,y:-r+d},{x:s-i,y:-d},{x:s,y:-d}]:n.has("right")&&n.has("up")?[{x:0,y:0},{x:s,y:-i},{x:0,y:-r}]:n.has("right")&&n.has("down")?[{x:0,y:0},{x:s,y:0},{x:0,y:-r}]:n.has("left")&&n.has("up")?[{x:s,y:0},{x:0,y:-i},{x:s,y:-r}]:n.has("left")&&n.has("down")?[{x:s,y:0},{x:0,y:0},{x:s,y:-r}]:n.has("right")?[{x:i,y:-d},{x:i,y:-d},{x:s-i,y:-d},{x:s-i,y:0},{x:s,y:-r/2},{x:s-i,y:-r},{x:s-i,y:-r+d},{x:i,y:-r+d},{x:i,y:-r+d}]:n.has("left")?[{x:i,y:0},{x:i,y:-d},{x:s-i,y:-d},{x:s-i,y:-r+d},{x:i,y:-r+d},{x:i,y:-r},{x:0,y:-r/2}]:n.has("up")?[{x:i,y:-d},{x:i,y:-r+d},{x:0,y:-r+d},{x:s/2,y:-r},{x:s,y:-r+d},{x:s-i,y:-r+d},{x:s-i,y:-d}]:n.has("down")?[{x:s/2,y:0},{x:0,y:-d},{x:i,y:-d},{x:i,y:-r+d},{x:s-i,y:-r+d},{x:s-i,y:-d},{x:s,y:-d}]:[{x:0,y:0}]},J=a=>a?" "+a:"",$=(a,t)=>`node default${J(a.classes)} ${J(a.class)}`,K=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=n.width+t.padding,r=n.height+t.padding,i=l+r,s=[{x:i/2,y:0},{x:i,y:-i/2},{x:i/2,y:-i},{x:0,y:-i/2}];f.info("Question main (Circle)");let d=X(e,i,i,s);return d.attr("style",t.style),m(t,d),t.intersect=function(o){return f.warn("Intersect called"),b.polygon(t,s,o)},e},Xt=(a,t)=>{let e=a.insert("g").attr("class","node default").attr("id",t.domId||t.id),n=28,l=[{x:0,y:n/2},{x:n/2,y:0},{x:0,y:-n/2},{x:-n/2,y:0}];return e.insert("polygon",":first-child").attr("points",l.map(function(r){return r.x+","+r.y}).join(" ")).attr("class","state-start").attr("r",7).attr("width",28).attr("height",28),t.width=28,t.height=28,t.intersect=function(r){return b.circle(t,14,r)},e},Wt=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=4,r=n.height+t.padding,i=r/l,s=n.width+2*i+t.padding,d=[{x:i,y:0},{x:s-i,y:0},{x:s,y:-r/2},{x:s-i,y:-r},{x:i,y:-r},{x:0,y:-r/2}],o=X(e,s,r,d);return o.attr("style",t.style),m(t,o),t.intersect=function(h){return b.polygon(t,d,h)},e},It=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,void 0,!0),l=2,r=n.height+2*t.padding,i=r/l,s=n.width+2*i+t.padding,d=Rt(t.directions,n,t),o=X(e,s,r,d);return o.attr("style",t.style),m(t,o),t.intersect=function(h){return b.polygon(t,d,h)},e},Ot=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=n.width+t.padding,r=n.height+t.padding,i=[{x:-r/2,y:0},{x:l,y:0},{x:l,y:-r},{x:-r/2,y:-r},{x:0,y:-r/2}];return X(e,l,r,i).attr("style",t.style),t.width=l+r,t.height=r,t.intersect=function(s){return b.polygon(t,i,s)},e},Yt=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=n.width+t.padding,r=n.height+t.padding,i=[{x:-2*r/6,y:0},{x:l-r/6,y:0},{x:l+2*r/6,y:-r},{x:r/6,y:-r}],s=X(e,l,r,i);return s.attr("style",t.style),m(t,s),t.intersect=function(d){return b.polygon(t,i,d)},e},Ht=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=n.width+t.padding,r=n.height+t.padding,i=[{x:2*r/6,y:0},{x:l+r/6,y:0},{x:l-2*r/6,y:-r},{x:-r/6,y:-r}],s=X(e,l,r,i);return s.attr("style",t.style),m(t,s),t.intersect=function(d){return b.polygon(t,i,d)},e},Nt=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=n.width+t.padding,r=n.height+t.padding,i=[{x:-2*r/6,y:0},{x:l+2*r/6,y:0},{x:l-r/6,y:-r},{x:r/6,y:-r}],s=X(e,l,r,i);return s.attr("style",t.style),m(t,s),t.intersect=function(d){return b.polygon(t,i,d)},e},jt=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=n.width+t.padding,r=n.height+t.padding,i=[{x:r/6,y:0},{x:l-r/6,y:0},{x:l+2*r/6,y:-r},{x:-2*r/6,y:-r}],s=X(e,l,r,i);return s.attr("style",t.style),m(t,s),t.intersect=function(d){return b.polygon(t,i,d)},e},Dt=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=n.width+t.padding,r=n.height+t.padding,i=[{x:0,y:0},{x:l+r/2,y:0},{x:l,y:-r/2},{x:l+r/2,y:-r},{x:0,y:-r}],s=X(e,l,r,i);return s.attr("style",t.style),m(t,s),t.intersect=function(d){return b.polygon(t,i,d)},e},Ut=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=n.width+t.padding,r=l/2,i=r/(2.5+l/50),s=n.height+i+t.padding,d="M 0,"+i+" a "+r+","+i+" 0,0,0 "+l+" 0 a "+r+","+i+" 0,0,0 "+-l+" 0 l 0,"+s+" a "+r+","+i+" 0,0,0 "+l+" 0 l 0,"+-s,o=e.attr("label-offset-y",i).insert("path",":first-child").attr("style",t.style).attr("d",d).attr("transform","translate("+-l/2+","+-(s/2+i)+")");return m(t,o),t.intersect=function(h){let c=b.rect(t,h),p=c.x-t.x;if(r!=0&&(Math.abs(p)<t.width/2||Math.abs(p)==t.width/2&&Math.abs(c.y-t.y)>t.height/2-i)){let y=i*i*(1-p*p/(r*r));y!=0&&(y=Math.sqrt(y)),y=i-y,h.y-t.y>0&&(y=-y),c.y+=y}return c},e},At=async(a,t)=>{let{shapeSvg:e,bbox:n,halfPadding:l}=await M(a,t,"node "+t.classes+" "+t.class,!0),r=e.insert("rect",":first-child"),i=t.positioned?t.width:n.width+t.padding,s=t.positioned?t.height:n.height+t.padding,d=t.positioned?-i/2:-n.width/2-l,o=t.positioned?-s/2:-n.height/2-l;if(r.attr("class","basic label-container").attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("x",d).attr("y",o).attr("width",i).attr("height",s),t.props){let h=new Set(Object.keys(t.props));t.props.borders&&(V(r,t.props.borders,i,s),h.delete("borders")),h.forEach(c=>{f.warn(`Unknown node property ${c}`)})}return m(t,r),t.intersect=function(h){return b.rect(t,h)},e},Zt=async(a,t)=>{let{shapeSvg:e,bbox:n,halfPadding:l}=await M(a,t,"node "+t.classes,!0),r=e.insert("rect",":first-child"),i=t.positioned?t.width:n.width+t.padding,s=t.positioned?t.height:n.height+t.padding,d=t.positioned?-i/2:-n.width/2-l,o=t.positioned?-s/2:-n.height/2-l;if(r.attr("class","basic cluster composite label-container").attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("x",d).attr("y",o).attr("width",i).attr("height",s),t.props){let h=new Set(Object.keys(t.props));t.props.borders&&(V(r,t.props.borders,i,s),h.delete("borders")),h.forEach(c=>{f.warn(`Unknown node property ${c}`)})}return m(t,r),t.intersect=function(h){return b.rect(t,h)},e},zt=async(a,t)=>{let{shapeSvg:e}=await M(a,t,"label",!0);f.trace("Classes = ",t.class);let n=e.insert("rect",":first-child"),l=0,r=0;if(n.attr("width",l).attr("height",r),e.attr("class","label edgeLabel"),t.props){let i=new Set(Object.keys(t.props));t.props.borders&&(V(n,t.props.borders,l,r),i.delete("borders")),i.forEach(s=>{f.warn(`Unknown node property ${s}`)})}return m(t,n),t.intersect=function(i){return b.rect(t,i)},e};function V(a,t,e,n){let l=[],r=s=>{l.push(s,0)},i=s=>{l.push(0,s)};t.includes("t")?(f.debug("add top border"),r(e)):i(e),t.includes("r")?(f.debug("add right border"),r(n)):i(n),t.includes("b")?(f.debug("add bottom border"),r(e)):i(e),t.includes("l")?(f.debug("add left border"),r(n)):i(n),a.attr("stroke-dasharray",l.join(" "))}var qt=(a,t)=>{let e;t.classes?e="node "+t.classes:e="node default";let n=a.insert("g").attr("class",e).attr("id",t.domId||t.id),l=n.insert("rect",":first-child"),r=n.insert("line"),i=n.insert("g").attr("class","label"),s=t.labelText.flat?t.labelText.flat():t.labelText,d="";typeof s=="object"?d=s[0]:d=s,f.info("Label text abc79",d,s,typeof s=="object");let o=i.node().appendChild(P(d,t.labelStyle,!0,!0)),h={width:0,height:0};if(R(u().flowchart.htmlLabels)){let k=o.children[0],g=_(o);h=k.getBoundingClientRect(),g.attr("width",h.width),g.attr("height",h.height)}f.info("Text 2",s);let c=s.slice(1,s.length),p=o.getBBox(),y=i.node().appendChild(P(c.join?c.join("<br/>"):c,t.labelStyle,!0,!0));if(R(u().flowchart.htmlLabels)){let k=y.children[0],g=_(y);h=k.getBoundingClientRect(),g.attr("width",h.width),g.attr("height",h.height)}let x=t.padding/2;return _(y).attr("transform","translate( "+(h.width>p.width?0:(p.width-h.width)/2)+", "+(p.height+x+5)+")"),_(o).attr("transform","translate( "+(h.width<p.width?0:-(p.width-h.width)/2)+", 0)"),h=i.node().getBBox(),i.attr("transform","translate("+-h.width/2+", "+(-h.height/2-x+3)+")"),l.attr("class","outer title-state").attr("x",-h.width/2-x).attr("y",-h.height/2-x).attr("width",h.width+t.padding).attr("height",h.height+t.padding),r.attr("class","divider").attr("x1",-h.width/2-x).attr("x2",h.width/2+x).attr("y1",-h.height/2-x+p.height+x).attr("y2",-h.height/2-x+p.height+x),m(t,l),t.intersect=function(k){return b.rect(t,k)},n},Gt=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=n.height+t.padding,r=n.width+l/4+t.padding,i=e.insert("rect",":first-child").attr("style",t.style).attr("rx",l/2).attr("ry",l/2).attr("x",-r/2).attr("y",-l/2).attr("width",r).attr("height",l);return m(t,i),t.intersect=function(s){return b.rect(t,s)},e},Vt=async(a,t)=>{let{shapeSvg:e,bbox:n,halfPadding:l}=await M(a,t,$(t),!0),r=e.insert("circle",":first-child");return r.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",n.width/2+l).attr("width",n.width+t.padding).attr("height",n.height+t.padding),f.info("Circle main"),m(t,r),t.intersect=function(i){return f.info("Circle intersect",t,n.width/2+l,i),b.circle(t,n.width/2+l,i)},e},Qt=async(a,t)=>{let{shapeSvg:e,bbox:n,halfPadding:l}=await M(a,t,$(t),!0),r=5,i=e.insert("g",":first-child"),s=i.insert("circle"),d=i.insert("circle");return i.attr("class",t.class),s.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",n.width/2+l+r).attr("width",n.width+t.padding+r*2).attr("height",n.height+t.padding+r*2),d.attr("style",t.style).attr("rx",t.rx).attr("ry",t.ry).attr("r",n.width/2+l).attr("width",n.width+t.padding).attr("height",n.height+t.padding),f.info("DoubleCircle main"),m(t,s),t.intersect=function(o){return f.info("DoubleCircle intersect",t,n.width/2+l+r,o),b.circle(t,n.width/2+l+r,o)},e},Ft=async(a,t)=>{let{shapeSvg:e,bbox:n}=await M(a,t,$(t),!0),l=n.width+t.padding,r=n.height+t.padding,i=[{x:0,y:0},{x:l,y:0},{x:l,y:-r},{x:0,y:-r},{x:0,y:0},{x:-8,y:0},{x:l+8,y:0},{x:l+8,y:-r},{x:-8,y:-r},{x:-8,y:0}],s=X(e,l,r,i);return s.attr("style",t.style),m(t,s),t.intersect=function(d){return b.polygon(t,i,d)},e},Jt=(a,t)=>{let e=a.insert("g").attr("class","node default").attr("id",t.domId||t.id),n=e.insert("circle",":first-child");return n.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14),m(t,n),t.intersect=function(l){return b.circle(t,7,l)},e},tt=(a,t,e)=>{let n=a.insert("g").attr("class","node default").attr("id",t.domId||t.id),l=70,r=10;e==="LR"&&(l=10,r=70);let i=n.append("rect").attr("x",-1*l/2).attr("y",-1*r/2).attr("width",l).attr("height",r).attr("class","fork-join");return m(t,i),t.height=t.height+t.padding/2,t.width=t.width+t.padding/2,t.intersect=function(s){return b.rect(t,s)},n},Kt=(a,t)=>{let e=a.insert("g").attr("class","node default").attr("id",t.domId||t.id),n=e.insert("circle",":first-child"),l=e.insert("circle",":first-child");return l.attr("class","state-start").attr("r",7).attr("width",14).attr("height",14),n.attr("class","state-end").attr("r",5).attr("width",10).attr("height",10),m(t,l),t.intersect=function(r){return b.circle(t,7,r)},e},tr=(a,t)=>{let e=t.padding/2,n=4,l=8,r;t.classes?r="node "+t.classes:r="node default";let i=a.insert("g").attr("class",r).attr("id",t.domId||t.id),s=i.insert("rect",":first-child"),d=i.insert("line"),o=i.insert("line"),h=0,c=n,p=i.insert("g").attr("class","label"),y=0,x=t.classData.annotations&&t.classData.annotations[0],k=t.classData.annotations[0]?"«"+t.classData.annotations[0]+"»":"",g=p.node().appendChild(P(k,t.labelStyle,!0,!0)),w=g.getBBox();if(R(u().flowchart.htmlLabels)){let L=g.children[0],S=_(g);w=L.getBoundingClientRect(),S.attr("width",w.width),S.attr("height",w.height)}t.classData.annotations[0]&&(c+=w.height+n,h+=w.width);let v=t.classData.label;t.classData.type!==void 0&&t.classData.type!==""&&(u().flowchart.htmlLabels?v+="&lt;"+t.classData.type+"&gt;":v+="<"+t.classData.type+">");let B=p.node().appendChild(P(v,t.labelStyle,!0,!0));_(B).attr("class","classTitle");let C=B.getBBox();if(R(u().flowchart.htmlLabels)){let L=B.children[0],S=_(B);C=L.getBoundingClientRect(),S.attr("width",C.width),S.attr("height",C.height)}c+=C.height+n,C.width>h&&(h=C.width);let O=[];t.classData.members.forEach(L=>{let S=L.getDisplayDetails(),Y=S.displayText;u().flowchart.htmlLabels&&(Y=Y.replace(/</g,"&lt;").replace(/>/g,"&gt;"));let W=p.node().appendChild(P(Y,S.cssStyle?S.cssStyle:t.labelStyle,!0,!0)),E=W.getBBox();if(R(u().flowchart.htmlLabels)){let q=W.children[0],j=_(W);E=q.getBoundingClientRect(),j.attr("width",E.width),j.attr("height",E.height)}E.width>h&&(h=E.width),c+=E.height+n,O.push(W)}),c+=l;let N=[];if(t.classData.methods.forEach(L=>{let S=L.getDisplayDetails(),Y=S.displayText;u().flowchart.htmlLabels&&(Y=Y.replace(/</g,"&lt;").replace(/>/g,"&gt;"));let W=p.node().appendChild(P(Y,S.cssStyle?S.cssStyle:t.labelStyle,!0,!0)),E=W.getBBox();if(R(u().flowchart.htmlLabels)){let q=W.children[0],j=_(W);E=q.getBoundingClientRect(),j.attr("width",E.width),j.attr("height",E.height)}E.width>h&&(h=E.width),c+=E.height+n,N.push(W)}),c+=l,x){let L=(h-w.width)/2;_(g).attr("transform","translate( "+(-1*h/2+L)+", "+-1*c/2+")"),y=w.height+n}let st=(h-C.width)/2;return _(B).attr("transform","translate( "+(-1*h/2+st)+", "+(-1*c/2+y)+")"),y+=C.height+n,d.attr("class","divider").attr("x1",-h/2-e).attr("x2",h/2+e).attr("y1",-c/2-e+l+y).attr("y2",-c/2-e+l+y),y+=l,O.forEach(L=>{_(L).attr("transform","translate( "+-h/2+", "+(-1*c/2+y+l/2)+")");let S=L==null?void 0:L.getBBox();y+=((S==null?void 0:S.height)??0)+n}),y+=l,o.attr("class","divider").attr("x1",-h/2-e).attr("x2",h/2+e).attr("y1",-c/2-e+l+y).attr("y2",-c/2-e+l+y),y+=l,N.forEach(L=>{_(L).attr("transform","translate( "+-h/2+", "+(-1*c/2+y)+")");let S=L==null?void 0:L.getBBox();y+=((S==null?void 0:S.height)??0)+n}),s.attr("style",t.style).attr("class","outer title-state").attr("x",-h/2-e).attr("y",-(c/2)-e).attr("width",h+t.padding).attr("height",c+t.padding),m(t,s),t.intersect=function(L){return b.rect(t,L)},i},rt={rhombus:K,composite:Zt,question:K,rect:At,labelRect:zt,rectWithTitle:qt,choice:Xt,circle:Vt,doublecircle:Qt,stadium:Gt,hexagon:Wt,block_arrow:It,rect_left_inv_arrow:Ot,lean_right:Yt,lean_left:Ht,trapezoid:Nt,inv_trapezoid:jt,rect_right_inv_arrow:Dt,cylinder:Ut,start:Jt,end:Kt,note:$t,subroutine:Ft,fork:tt,join:tt,class_box:tr},H={},cr=async(a,t,e)=>{let n,l;if(t.link){let r;u().securityLevel==="sandbox"?r="_top":t.linkTarget&&(r=t.linkTarget||"_blank"),n=a.insert("svg:a").attr("xlink:href",t.link).attr("target",r),l=await rt[t.shape](n,t,e)}else l=await rt[t.shape](a,t,e),n=l;return t.tooltip&&l.attr("title",t.tooltip),t.class&&l.attr("class","node default "+t.class),n.attr("data-node","true"),n.attr("data-id",t.id),H[t.id]=n,t.haveCallback&&H[t.id].attr("class",H[t.id].attr("class")+" clickable"),n},yr=(a,t)=>{H[t.id]=a},pr=()=>{H={}},gr=a=>{let t=H[a.id];f.trace("Transforming node",a.diff,a,"translate("+(a.x-a.width/2-5)+", "+a.width/2+")");let e=8,n=a.diff||0;return a.clusterNode?t.attr("transform","translate("+(a.x+n-a.width/2)+", "+(a.y-a.height/2-e)+")"):t.attr("transform","translate("+a.x+", "+a.y+")"),n},rr=({flowchart:a})=>{var t,e;let n=((t=a==null?void 0:a.subGraphTitleMargin)==null?void 0:t.top)??0,l=((e=a==null?void 0:a.subGraphTitleMargin)==null?void 0:e.bottom)??0,r=n+l;return{subGraphTitleTopMargin:n,subGraphTitleBottomMargin:l,subGraphTitleTotalMargin:r}},I={aggregation:18,extension:18,composition:18,dependency:6,lollipop:13.5,arrow_point:5.3};function U(a,t){if(a===void 0||t===void 0)return{angle:0,deltaX:0,deltaY:0};a=Z(a),t=Z(t);let[e,n]=[a.x,a.y],[l,r]=[t.x,t.y],i=l-e,s=r-n;return{angle:Math.atan(s/i),deltaX:i,deltaY:s}}var Z=a=>Array.isArray(a)?{x:a[0],y:a[1]}:a,er=a=>({x:function(t,e,n){let l=0;if(e===0&&Object.hasOwn(I,a.arrowTypeStart)){let{angle:r,deltaX:i}=U(n[0],n[1]);l=I[a.arrowTypeStart]*Math.cos(r)*(i>=0?1:-1)}else if(e===n.length-1&&Object.hasOwn(I,a.arrowTypeEnd)){let{angle:r,deltaX:i}=U(n[n.length-1],n[n.length-2]);l=I[a.arrowTypeEnd]*Math.cos(r)*(i>=0?1:-1)}return Z(t).x+l},y:function(t,e,n){let l=0;if(e===0&&Object.hasOwn(I,a.arrowTypeStart)){let{angle:r,deltaY:i}=U(n[0],n[1]);l=I[a.arrowTypeStart]*Math.abs(Math.sin(r))*(i>=0?1:-1)}else if(e===n.length-1&&Object.hasOwn(I,a.arrowTypeEnd)){let{angle:r,deltaY:i}=U(n[n.length-1],n[n.length-2]);l=I[a.arrowTypeEnd]*Math.abs(Math.sin(r))*(i>=0?1:-1)}return Z(t).y+l}}),ar=(a,t,e,n,l)=>{t.arrowTypeStart&&et(a,"start",t.arrowTypeStart,e,n,l),t.arrowTypeEnd&&et(a,"end",t.arrowTypeEnd,e,n,l)},ir={arrow_cross:"cross",arrow_point:"point",arrow_barb:"barb",arrow_circle:"circle",aggregation:"aggregation",extension:"extension",composition:"composition",dependency:"dependency",lollipop:"lollipop"},et=(a,t,e,n,l,r)=>{let i=ir[e];if(!i){f.warn(`Unknown arrow type: ${e}`);return}let s=t==="start"?"Start":"End";a.attr(`marker-${t}`,`url(${n}#${l}_${r}-${i}${s})`)},z={},T={},xr=()=>{z={},T={}},fr=(a,t)=>{let e=R(u().flowchart.htmlLabels),n=t.labelType==="markdown"?it(a,t.label,{style:t.labelStyle,useHtmlLabels:e,addSvgBackground:!0}):P(t.label,t.labelStyle),l=a.insert("g").attr("class","edgeLabel"),r=l.insert("g").attr("class","label");r.node().appendChild(n);let i=n.getBBox();if(e){let d=n.children[0],o=_(n);i=d.getBoundingClientRect(),o.attr("width",i.width),o.attr("height",i.height)}r.attr("transform","translate("+-i.width/2+", "+-i.height/2+")"),z[t.id]=l,t.width=i.width,t.height=i.height;let s;if(t.startLabelLeft){let d=P(t.startLabelLeft,t.labelStyle),o=a.insert("g").attr("class","edgeTerminals"),h=o.insert("g").attr("class","inner");s=h.node().appendChild(d);let c=d.getBBox();h.attr("transform","translate("+-c.width/2+", "+-c.height/2+")"),T[t.id]||(T[t.id]={}),T[t.id].startLeft=o,A(s,t.startLabelLeft)}if(t.startLabelRight){let d=P(t.startLabelRight,t.labelStyle),o=a.insert("g").attr("class","edgeTerminals"),h=o.insert("g").attr("class","inner");s=o.node().appendChild(d),h.node().appendChild(d);let c=d.getBBox();h.attr("transform","translate("+-c.width/2+", "+-c.height/2+")"),T[t.id]||(T[t.id]={}),T[t.id].startRight=o,A(s,t.startLabelRight)}if(t.endLabelLeft){let d=P(t.endLabelLeft,t.labelStyle),o=a.insert("g").attr("class","edgeTerminals"),h=o.insert("g").attr("class","inner");s=h.node().appendChild(d);let c=d.getBBox();h.attr("transform","translate("+-c.width/2+", "+-c.height/2+")"),o.node().appendChild(d),T[t.id]||(T[t.id]={}),T[t.id].endLeft=o,A(s,t.endLabelLeft)}if(t.endLabelRight){let d=P(t.endLabelRight,t.labelStyle),o=a.insert("g").attr("class","edgeTerminals"),h=o.insert("g").attr("class","inner");s=h.node().appendChild(d);let c=d.getBBox();h.attr("transform","translate("+-c.width/2+", "+-c.height/2+")"),o.node().appendChild(d),T[t.id]||(T[t.id]={}),T[t.id].endRight=o,A(s,t.endLabelRight)}return n};function A(a,t){u().flowchart.htmlLabels&&a&&(a.style.width=t.length*9+"px",a.style.height="12px")}var wr=(a,t)=>{f.debug("Moving label abc88 ",a.id,a.label,z[a.id],t);let e=t.updatedPath?t.updatedPath:t.originalPath,n=u(),{subGraphTitleTotalMargin:l}=rr(n);if(a.label){let r=z[a.id],i=a.x,s=a.y;if(e){let d=D.calcLabelPosition(e);f.debug("Moving label "+a.label+" from (",i,",",s,") to (",d.x,",",d.y,") abc88"),t.updatedPath&&(i=d.x,s=d.y)}r.attr("transform",`translate(${i}, ${s+l/2})`)}if(a.startLabelLeft){let r=T[a.id].startLeft,i=a.x,s=a.y;if(e){let d=D.calcTerminalLabelPosition(a.arrowTypeStart?10:0,"start_left",e);i=d.x,s=d.y}r.attr("transform",`translate(${i}, ${s})`)}if(a.startLabelRight){let r=T[a.id].startRight,i=a.x,s=a.y;if(e){let d=D.calcTerminalLabelPosition(a.arrowTypeStart?10:0,"start_right",e);i=d.x,s=d.y}r.attr("transform",`translate(${i}, ${s})`)}if(a.endLabelLeft){let r=T[a.id].endLeft,i=a.x,s=a.y;if(e){let d=D.calcTerminalLabelPosition(a.arrowTypeEnd?10:0,"end_left",e);i=d.x,s=d.y}r.attr("transform",`translate(${i}, ${s})`)}if(a.endLabelRight){let r=T[a.id].endRight,i=a.x,s=a.y;if(e){let d=D.calcTerminalLabelPosition(a.arrowTypeEnd?10:0,"end_right",e);i=d.x,s=d.y}r.attr("transform",`translate(${i}, ${s})`)}},nr=(a,t)=>{let e=a.x,n=a.y,l=Math.abs(t.x-e),r=Math.abs(t.y-n),i=a.width/2,s=a.height/2;return l>=i||r>=s},sr=(a,t,e)=>{f.debug(`intersection calc abc89:
  outsidePoint: ${JSON.stringify(t)}
  insidePoint : ${JSON.stringify(e)}
  node        : x:${a.x} y:${a.y} w:${a.width} h:${a.height}`);let n=a.x,l=a.y,r=Math.abs(n-e.x),i=a.width/2,s=e.x<t.x?i-r:i+r,d=a.height/2,o=Math.abs(t.y-e.y),h=Math.abs(t.x-e.x);if(Math.abs(l-t.y)*i>Math.abs(n-t.x)*d){let c=e.y<t.y?t.y-d-l:l-d-t.y;s=h*c/o;let p={x:e.x<t.x?e.x+s:e.x-h+s,y:e.y<t.y?e.y+o-c:e.y-o+c};return s===0&&(p.x=t.x,p.y=t.y),h===0&&(p.x=t.x),o===0&&(p.y=t.y),f.debug(`abc89 topp/bott calc, Q ${o}, q ${c}, R ${h}, r ${s}`,p),p}else{e.x<t.x?s=t.x-i-n:s=n-i-t.x;let c=o*s/h,p=e.x<t.x?e.x+h-s:e.x-h+s,y=e.y<t.y?e.y+c:e.y-c;return f.debug(`sides calc abc89, Q ${o}, q ${c}, R ${h}, r ${s}`,{_x:p,_y:y}),s===0&&(p=t.x,y=t.y),h===0&&(p=t.x),o===0&&(y=t.y),{x:p,y}}},at=(a,t)=>{f.debug("abc88 cutPathAtIntersect",a,t);let e=[],n=a[0],l=!1;return a.forEach(r=>{if(!nr(t,r)&&!l){let i=sr(t,n,r),s=!1;e.forEach(d=>{s=s||d.x===i.x&&d.y===i.y}),e.some(d=>d.x===i.x&&d.y===i.y)||e.push(i),l=!0}else n=r,l||e.push(r)}),e},ur=function(a,t,e,n,l,r,i){let s=e.points;f.debug("abc88 InsertEdge: edge=",e,"e=",t);let d=!1,o=r.node(t.v);var h=r.node(t.w);h!=null&&h.intersect&&(o!=null&&o.intersect)&&(s=s.slice(1,e.points.length-1),s.unshift(o.intersect(s[0])),s.push(h.intersect(s[s.length-1]))),e.toCluster&&(f.debug("to cluster abc88",n[e.toCluster]),s=at(e.points,n[e.toCluster].node),d=!0),e.fromCluster&&(f.debug("from cluster abc88",n[e.fromCluster]),s=at(s.reverse(),n[e.fromCluster].node).reverse(),d=!0);let c=s.filter(C=>!Number.isNaN(C.y)),p=dt;e.curve&&(l==="graph"||l==="flowchart")&&(p=e.curve);let{x:y,y:x}=er(e),k=lt().x(y).y(x).curve(p),g;switch(e.thickness){case"normal":g="edge-thickness-normal";break;case"thick":g="edge-thickness-thick";break;case"invisible":g="edge-thickness-thick";break;default:g=""}switch(e.pattern){case"solid":g+=" edge-pattern-solid";break;case"dotted":g+=" edge-pattern-dotted";break;case"dashed":g+=" edge-pattern-dashed";break}let w=a.append("path").attr("d",k(c)).attr("id",e.id).attr("class"," "+g+(e.classes?" "+e.classes:"")).attr("style",e.style),v="";(u().flowchart.arrowMarkerAbsolute||u().state.arrowMarkerAbsolute)&&(v=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,v=v.replace(/\(/g,"\\("),v=v.replace(/\)/g,"\\)")),ar(w,e,v,i,l);let B={};return d&&(B.updatedPath=s),B.originalPath=e.points,B};export{Ct as C,M,P as R,er as a,wr as b,gr as d,ar as e,yr as f,xr as g,m,cr as p,rr as r,fr as u,ur as w,pr as x,or as y};
